<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title></title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- xhtml,charset=utf-8,html --> 
<meta name="src" content="main.tex" /> 
<link rel="stylesheet" type="text/css" href="main.css" /> 
</head><body 
>
                                                                
                                                                
<!--l. 18--><p class="noindent" >
                                                                
                                                                
                                                                
                                                                
</p>
<div class="center" 
>
<!--l. 3--><p class="noindent" >
</p><!--l. 5--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-248">The Tao of Ansible</span></p></div>
                                                                
                                                                
<div class="center" 
>
<!--l. 5--><p class="noindent" >
</p><!--l. 8--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-248">The Tao of Ansible</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-144">Mastering Automation with Simplicity and Grace</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-144">John Stilia</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-109">Ioannis Stylianakos</span><br />
</p>
</div>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
<div class="center" 
>
<!--l. 5--><p class="noindent" >
</p><!--l. 9--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">Copyright </span><span 
class="ts1-qtmr-x-x-109">© </span><span 
class="ntx-Regular-tlf-t1-x-x-109">2025 John Stilia (Ioannis Stylianakos)</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-109">All rights reserved.</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-109">No part of this publication may be reproduced, distributed, or transmitted in</span>
<span 
class="ntx-Regular-tlf-t1-x-x-109">any form or by any means, including photocopying, recording, or other</span>
<span 
class="ntx-Regular-tlf-t1-x-x-109">electronic or mechanical methods, without the prior written permission of</span>
<span 
class="ntx-Regular-tlf-t1-x-x-109">the publisher, except in the case of brief quotations embodied in critical</span>
<span 
class="ntx-Regular-tlf-t1-x-x-109">reviews and certain other noncommercial uses permitted by copyright law.</span><br /><br />
<span 
class="ntx-Regular-tlf-t1-x-x-109">First Edition</span><br /><br />
</p>
</div>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
<div class="center" 
>
<!--l. 5--><p class="noindent" >
</p><!--l. 6--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-172">Dedication</span><br /><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">To the seekers of elegant automation,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">the craftspeople of infrastructure,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">and the believers in the power of code.</span><br /><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">To those who understand that</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">true automation is not just about eﬃciency,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">but about creating space for human creativity.</span><br /><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">And especially to all who embrace</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">the philosophy that simplicity</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">is the ultimate sophistication.</span><br /><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">May this guide light your path</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">through the elegant world of Ansible,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">where complexity yields to clarity,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-120">and chaos transforms into harmony.</span><br /><br />
<span 
class="ntx-Italic-tlf-t1-x-x-109">And most importantly,</span><br />
                                                                
                                                                
<span 
class="ntx-Italic-tlf-t1-x-x-109">To my partner in life Beatriz,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-109">for her patience and support</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-109">and for being my best friend,</span><br />
<span 
class="ntx-Italic-tlf-t1-x-x-109">strongest critic, and most trusted conﬁdant.</span>
</p></div>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
<h2 class="likechapterHead"><a 
 id="x1-1000"></a>Preface</h2>
<a 
 id="Q1-1-2"></a>
<h3 class="likesectionHead"><a 
 id="x1-2000"></a>About this Book</h3>
<!--l. 9--><p class="noindent" >This book serves as an entry-level guide to learning Ansible, highlighting
its elegant simplicity and powerful automation capabilities. Through
practical examples and clear explanations, you’ll discover how Ansible’s
straightforward approach makes infrastructure automation accessible while
providing the robust features needed for complex deployments. For the
curious reader, we’ve hidden several easter eggs throughout the book -
small surprises that reward careful attention to detail.
</p>
<h3 class="likesectionHead"><a 
 id="x1-3000"></a>Styles</h3>
<a 
 id="Q1-1-5"></a>
<!--l. 15--><p class="noindent" >Throughout this book, you’ll encounter various formatting styles to enhance
readability and highlight important information:
</p>
  <ul class="itemize1">
  <li class="itemize">
  <!--l. 19--><p class="noindent" ><span 
class="pcrr8t-x-x-120">Code blocks </span>- For commands and conﬁgurations
                                                                
                                                                
  </p></li>
  <li class="itemize">
  <!--l. 20--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Key concepts </span>- Highlighted in bold
  </p></li>
  <li class="itemize">
  <!--l. 21--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Notes and tips </span>- Presented in italics
  </p></li>
  <li class="itemize">
  <!--l. 22--><p class="noindent" >Examples - Practical demonstrations of concepts
  </p></li>
  <li class="itemize">
  <!--l. 23--><p class="noindent" ><span class="fbox">Boxed content</span> - For special attention or warnings
  </p></li>
  <li class="itemize">
  <!--l. 24--><p class="noindent" ><span class="underline">Underlined text</span> - For emphasis or deﬁnitions</p></li></ul>
<h3 class="likesectionHead"><a 
 id="x1-4000"></a>Command Notation</h3>
<a 
 id="Q1-1-7"></a>
<!--l. 31--><p class="noindent" >When presenting commands and code examples, we use speciﬁc notation to
enhance readability: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 33--><p class="noindent" ><span 
class="pcrr8t-x-x-120">command </span>- Basic commands (e.g., <span 
class="pcrr8t-x-x-120">ansible</span>)
      </p></li>
      <li class="itemize">
                                                                
                                                                
      <!--l. 34--><p class="noindent" ><span 
class="pcrr8t-x-x-120">[group] </span>- Inventory groups
      </p></li>
      <li class="itemize">
      <!--l. 35--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-m mod </span>- Module ﬂags
      </p></li>
      <li class="itemize">
      <!--l. 36--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-a "args" </span>- Module arguments</p></li></ul>
<!--l. 39--><p class="noindent" >Code blocks use <span 
class="pcrr8t-x-x-120">lstlisting </span>for syntax highlighting.
</p>
<h3 class="likesectionHead"><a 
 id="x1-5000"></a>How this Book is Structured</h3>
<a 
 id="Q1-1-9"></a>
<!--l. 44--><p class="noindent" >This book follows a natural learning progression, starting with foundational
concepts and gradually moving into more advanced territory. The
journey begins with core principles and setup, where you’ll learn the
basics of Ansible and its philosophy. From there, we explore practical
implementations and real-world scenarios, building your conﬁdence with
hands-on examples.
</p><!--l. 46--><p class="noindent" >As you progress, you’ll delve into more sophisticated topics like scaling,
security, and troubleshooting. Each section builds upon previous
knowledge, ensuring you have a solid understanding before tackling more
complex concepts. The book concludes with reﬂections on best practices
and guidance for your continued journey with Ansible.
</p><!--l. 48--><p class="noindent" >Throughout the text, practical examples and exercises reinforce theoretical
concepts, allowing you to learn by doing. Whether you’re new to
automation or looking to expand your skills, this structured approach helps
you build a comprehensive understanding of Ansible’s capabilities.
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="likechapterHead"><a 
 id="x1-6000"></a>The Hidden Path of Ansible</h2>
<a 
 id="Q1-1-11"></a>
<div class="center" 
>
<!--l. 5--><p class="noindent" >
</p><!--l. 6--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-144">Hidden Wisdom in The Tao of Ansible</span></p></div>
<!--l. 10--><p class="noindent" >Throughout this book, certain words of power lie hidden in plain sight,
marked in bold text. These words hold special signiﬁcance in the realm of
Ansible. Can you ﬁnd them all?
</p>
<div class="center" 
>
<!--l. 13--><p class="noindent" >
</p>
                                                                
                                                                
<div class="tabular"> <table id="TBL-1" class="tabular" 
 
><colgroup id="TBL-1-1g"><col 
id="TBL-1-1" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-1-1-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-1-1"  
class="td11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _        </span></td></tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-2-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-2-1"  
class="td
11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _ _ _ _ _</span></td></tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-3-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-3-1"  
class="td
11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _ _      </span></td></tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-4-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-4-1"  
class="td
11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _            </span></td></tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-5-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-5-1"  
class="td
11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _ _      </span></td></tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-6-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-6-1"  
class="td
11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _          </span></td>
</tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-7-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-7-1"  
class="td11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _        </span></td>
</tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-8-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-8-1"  
class="td11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _ _      </span></td>
</tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-9-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-9-1"  
class="td11"><span 
class="pcrr8t-x-x-144">_ _ _ _ _ _ _ _ _    </span></td>
</tr><tr 
class="vspace" style="font-size:8.5359pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-1-10-"><td  style="white-space:nowrap; text-align:left;" id="TBL-1-10-1"  
class="td11">                         </td>
</tr></table></div></div>
<!--l. 39--><p class="noindent" ><span class="fbox"><span 
class="ntx-Bold-tlf-t1-x-x-109">Hints:</span> </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 46--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">Look for words emphasized in </span><span 
class="ntx-Bold-tlf-t1-x-x-109">bold </span><span 
class="ntx-Regular-tlf-t1-x-x-109">throughout the chapters</span>
      </p></li>
      <li class="itemize">
      <!--l. 46--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">Each word is a key Ansible concept or command</span>
      </p></li>
      <li class="itemize">
      <!--l. 46--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">The number of underscores matches the length of each hidden word</span></p></li></ul>  </span>
<div class="center" 
>
<!--l. 50--><p class="noindent" >
</p><!--l. 51--><p class="noindent" ><span class="rotatebox" style="transform: rotate(-180deg);">                                                                      <!--tex4ht:inline--></p><div class="tabular"> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:normal; text-align:left;" id="TBL-2-1-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-109">Solution:</span>                                                                                                             </p></td></tr><tr 
class="vspace" style="font-size:5.69046pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:normal; text-align:left;" id="TBL-2-2-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">ANSIBLE, found in chapter 3</span></p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:normal; text-align:left;" id="TBL-2-3-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">IDEMPOTENCE found in chapter 4</span>                                                                    </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:normal; text-align:left;" id="TBL-2-4-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">WORKFLOW found in chapter 5</span>                                                                         </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:normal; text-align:left;" id="TBL-2-5-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">ROLES found in chapter 6</span>                                                                                   </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:normal; text-align:left;" id="TBL-2-6-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">VARIABLES found in chapter 7</span>                                                                          </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:normal; text-align:left;" id="TBL-2-7-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">ACTION found in chapter 8</span>                                                                                 </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="white-space:normal; text-align:left;" id="TBL-2-8-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">SCALING found in chapter 9</span>                                                                               </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="white-space:normal; text-align:left;" id="TBL-2-9-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">SECURITY found in chapter 10</span>                                                                          </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="white-space:normal; text-align:left;" id="TBL-2-10-1"  
class="td11"><!--l. 75--><p class="noindent" ><span 
class="ntx-Regular-tlf-t1-x-x-109">DEBUGGING found in chapter 12</span>                                                                      </p></td>
</tr><tr 
class="vspace" style="font-size:4.26773pt"><td 
>&nbsp;</td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="white-space:normal; text-align:left;" id="TBL-2-11-1"  
class="td11">                                                </td>
</tr></table>                                                  </div></span></div>
                                                                <div class="flushright" 
>
<!--l. 79--><p class="noindent" >
 <span 
class="ntx-Italic-tlf-t1-x-x-109">May your automation journey be guided by these words of power...</span></p></div>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
<h2 class="likechapterHead"><a 
 id="x1-7000"></a><span 
class="ntx-Bold-tlf-t1-x-x-172">Contents</span></h2>
<div class="tableofcontents">
<span class="chapterToc" > <a 
href="#Q1-1-2">Preface</a></span>
<br /> <span class="sectionToc" ><a 
href="#Q1-1-5">Styles</a></span>
<br /> <span class="sectionToc" ><a 
href="#Q1-1-7">Command Notation</a></span>
<br /> <span class="sectionToc" ><a 
href="#Q1-1-9">How this Book is Structured</a></span>
<br /><span class="chapterToc" > <a 
href="#Q1-1-11">The Hidden Path of Ansible</a></span>
<br /><span class="chapterToc" >1 <a 
href="#x1-80001" id="QQ2-1-13">Introduction</a></span>
<br /> <span class="sectionToc" >1.1 <a 
href="#x1-90001" id="QQ2-1-14">Philosophy of Simplicity in Automation</a></span>
<br /> <span class="sectionToc" >1.2 <a 
href="#x1-100002" id="QQ2-1-15">What is Ansible, and Why Should You Use It?</a></span>
<br /> <span class="sectionToc" >1.3 <a 
href="#x1-110003" id="QQ2-1-16">Core Principles of Ansible</a></span>
<br />  <span class="subsectionToc" >1.3.1 <a 
href="#x1-120001" id="QQ2-1-17">Agentless Operation</a></span>
<br />  <span class="subsectionToc" >1.3.2 <a 
href="#x1-130002" id="QQ2-1-18">YAML-Based Conﬁguration</a></span>
<br />  <span class="subsectionToc" >1.3.3 <a 
href="#x1-140003" id="QQ2-1-20">Idempotency</a></span>
<br /> <span class="sectionToc" >1.4 <a 
href="#x1-150004" id="QQ2-1-21">Why Ansible Matters</a></span>
                                                                
                                                                
<br /><span class="chapterToc" >2 <a 
href="#x1-160002" id="QQ2-1-22">Getting Started</a></span>
<br /> <span class="sectionToc" >2.1 <a 
href="#x1-170001" id="QQ2-1-23">Installing Ansible</a></span>
<br />  <span class="subsectionToc" >2.1.1 <a 
href="#x1-180001" id="QQ2-1-24">Installing on Linux</a></span>
<br />  <span class="subsectionToc" >2.1.2 <a 
href="#x1-190002" id="QQ2-1-27">Installing on macOS</a></span>
<br />  <span class="subsectionToc" >2.1.3 <a 
href="#x1-200003" id="QQ2-1-29">Installing on Windows</a></span>
<br /> <span class="sectionToc" >2.2 <a 
href="#x1-210002" id="QQ2-1-30">Setting Up a Basic Inventory File</a></span>
<br />  <span class="subsectionToc" >2.2.1 <a 
href="#x1-220001" id="QQ2-1-31">Creating Your First Inventory File</a></span>
<br />  <span class="subsectionToc" >2.2.2 <a 
href="#x1-230002" id="QQ2-1-33">Using Variables in the Inventory File</a></span>
<br /> <span class="sectionToc" >2.3 <a 
href="#x1-240003" id="QQ2-1-35">Running Your First Ad-Hoc Command</a></span>
<br />  <span class="subsectionToc" >2.3.1 <a 
href="#x1-250001" id="QQ2-1-36">Testing Connectivity</a></span>
<br />  <span class="subsectionToc" >2.3.2 <a 
href="#x1-260002" id="QQ2-1-39">Executing a Command</a></span>
<br />  <span class="subsectionToc" >2.3.3 <a 
href="#x1-270003" id="QQ2-1-41">Installing a Package</a></span>
<br /> <span class="sectionToc" >2.4 <a 
href="#x1-280004" id="QQ2-1-43">Wrapping Up</a></span>
<br /><span class="chapterToc" >3 <a 
href="#x1-290003" id="QQ2-1-44">Ansible Basics: Understanding Playbooks</a></span>
<br /> <span class="sectionToc" >3.1 <a 
href="#x1-300001" id="QQ2-1-45">What are Playbooks and Tasks?</a></span>
<br /> <span class="sectionToc" >3.2 <a 
href="#x1-310002" id="QQ2-1-47">Writing Your First Playbook</a></span>
<br />  <span class="subsectionToc" >3.2.1 <a 
href="#x1-320001" id="QQ2-1-49">Running the Playbook</a></span>
<br /> <span class="sectionToc" >3.3 <a 
href="#x1-330003" id="QQ2-1-51">Core Modules: File, Copy, Service</a></span>
<br />  <span class="subsectionToc" >3.3.1 <a 
href="#x1-340001" id="QQ2-1-52"><span 
class="pcrr8t-x-x-120">file</span></a></span>
                                                                
                                                                
<br />  <span class="subsectionToc" >3.3.2 <a 
href="#x1-350002" id="QQ2-1-54"><span 
class="pcrr8t-x-x-120">copy</span></a></span>
<br />  <span class="subsectionToc" >3.3.3 <a 
href="#x1-360003" id="QQ2-1-56"><span 
class="pcrr8t-x-x-120">service</span></a></span>
<br /> <span class="sectionToc" >3.4 <a 
href="#x1-370004" id="QQ2-1-58">Wrapping Up</a></span>
<br /><span class="chapterToc" >4 <a 
href="#x1-380004" id="QQ2-1-59">Thinking Like Ansible: Idempotence and Simplicity</a></span>
<br /> <span class="sectionToc" >4.1 <a 
href="#x1-390001" id="QQ2-1-60">Why Idempotence Matters</a></span>
<br /> <span class="sectionToc" >4.2 <a 
href="#x1-400002" id="QQ2-1-61">Writing Idempotent Tasks</a></span>
<br />  <span class="subsectionToc" >4.2.1 <a 
href="#x1-410001" id="QQ2-1-62">Installing a Package</a></span>
<br />  <span class="subsectionToc" >4.2.2 <a 
href="#x1-420002" id="QQ2-1-64">Creating a Directory</a></span>
<br />  <span class="subsectionToc" >4.2.3 <a 
href="#x1-430003" id="QQ2-1-66">Starting a Service</a></span>
<br /> <span class="sectionToc" >4.3 <a 
href="#x1-440003" id="QQ2-1-68">Idempotence in Practice</a></span>
<br /> <span class="sectionToc" >4.4 <a 
href="#x1-450004" id="QQ2-1-70">The Philosophy of Simplicity</a></span>
<br /> <span class="sectionToc" >4.5 <a 
href="#x1-460005" id="QQ2-1-71">Wrapping Up</a></span>
<br /><span class="chapterToc" >5 <a 
href="#x1-470005" id="QQ2-1-72">Your First Workﬂow: Automating Everyday Tasks</a></span>
<br /> <span class="sectionToc" >5.1 <a 
href="#x1-480001" id="QQ2-1-73">Automating Package Installations</a></span>
<br />  <span class="subsectionToc" >5.1.1 <a 
href="#x1-490001" id="QQ2-1-74">Installing One Package</a></span>
<br />  <span class="subsectionToc" >5.1.2 <a 
href="#x1-500002" id="QQ2-1-76">Installing Multiple Packages</a></span>
<br />  <span class="subsectionToc" >5.1.3 <a 
href="#x1-510003" id="QQ2-1-78">A Quick Reality Check</a></span>
<br /> <span class="sectionToc" >5.2 <a 
href="#x1-520002" id="QQ2-1-79">Managing Files and Directories</a></span>
<br />  <span class="subsectionToc" >5.2.1 <a 
href="#x1-530001" id="QQ2-1-80">Creating Directories</a></span>
                                                                
                                                                
<br />  <span class="subsectionToc" >5.2.2 <a 
href="#x1-540002" id="QQ2-1-82">Managing Files</a></span>
<br />  <span class="subsectionToc" >5.2.3 <a 
href="#x1-550003" id="QQ2-1-84">Copying Files</a></span>
<br /> <span class="sectionToc" >5.3 <a 
href="#x1-560003" id="QQ2-1-86">Conﬁguring Services</a></span>
<br />  <span class="subsectionToc" >5.3.1 <a 
href="#x1-570001" id="QQ2-1-87">Starting and Enabling Services</a></span>
<br />  <span class="subsectionToc" >5.3.2 <a 
href="#x1-580002" id="QQ2-1-89">Restarting Services</a></span>
<br />  <span class="subsectionToc" >5.3.3 <a 
href="#x1-590003" id="QQ2-1-91">Combining Tasks for a Workﬂow</a></span>
<br /> <span class="sectionToc" >5.4 <a 
href="#x1-600004" id="QQ2-1-93">Why Workﬂows Matter</a></span>
<br /> <span class="sectionToc" >5.5 <a 
href="#x1-610005" id="QQ2-1-94">Wrapping Up</a></span>
<br /><span class="chapterToc" >6 <a 
href="#x1-620006" id="QQ2-1-95">Building a Foundation: Roles and Reusability</a></span>
<br /> <span class="sectionToc" >6.1 <a 
href="#x1-630001" id="QQ2-1-96">Introduction to Roles</a></span>
<br />  <span class="subsectionToc" >6.1.1 <a 
href="#x1-640001" id="QQ2-1-97">Anatomy of a Role</a></span>
<br /> <span class="sectionToc" >6.2 <a 
href="#x1-650002" id="QQ2-1-98">Structuring Your Projects for Clarity</a></span>
<br />  <span class="subsectionToc" >6.2.1 <a 
href="#x1-660001" id="QQ2-1-99">The Big Picture</a></span>
<br />  <span class="subsectionToc" >6.2.2 <a 
href="#x1-670002" id="QQ2-1-100">Using Roles in a Playbook</a></span>
<br /> <span class="sectionToc" >6.3 <a 
href="#x1-680003" id="QQ2-1-102">Using Ansible Galaxy</a></span>
<br />  <span class="subsectionToc" >6.3.1 <a 
href="#x1-690001" id="QQ2-1-103">Installing a Role</a></span>
<br />  <span class="subsectionToc" >6.3.2 <a 
href="#x1-700002" id="QQ2-1-106">Creating Your Own Galaxy Role</a></span>
<br /> <span class="sectionToc" >6.4 <a 
href="#x1-710004" id="QQ2-1-108">Why Roles Matter</a></span>
<br /> <span class="sectionToc" >6.5 <a 
href="#x1-720005" id="QQ2-1-109">Wrapping Up</a></span>
                                                                
                                                                
<br /><span class="chapterToc" >7 <a 
href="#x1-730007" id="QQ2-1-110">Working with Variables, Facts, and Templates</a></span>
<br /> <span class="sectionToc" >7.1 <a 
href="#x1-740001" id="QQ2-1-111">Working with Variables</a></span>
<br />  <span class="subsectionToc" >7.1.1 <a 
href="#x1-750001" id="QQ2-1-112">Deﬁning Variables</a></span>
<br />  <span class="subsectionToc" >7.1.2 <a 
href="#x1-760002" id="QQ2-1-114">Using Group and Host Variables</a></span>
<br />  <span class="subsectionToc" >7.1.3 <a 
href="#x1-770003" id="QQ2-1-116">Overriding Variables</a></span>
<br /> <span class="sectionToc" >7.2 <a 
href="#x1-780002" id="QQ2-1-117">Using Facts</a></span>
<br />  <span class="subsectionToc" >7.2.1 <a 
href="#x1-790001" id="QQ2-1-118">Viewing Facts</a></span>
<br /> <span class="sectionToc" >7.3 <a 
href="#x1-800003" id="QQ2-1-121">Jinja2 Templates for Dynamic Conﬁguration Files</a></span>
<br />  <span class="subsectionToc" >7.3.1 <a 
href="#x1-810001" id="QQ2-1-122">Creating a Template</a></span>
<br />  <span class="subsectionToc" >7.3.2 <a 
href="#x1-820002" id="QQ2-1-124">Deploying a Template</a></span>
<br /> <span class="sectionToc" >7.4 <a 
href="#x1-830004" id="QQ2-1-126">Ansible in Action: Practical Use Cases</a></span>
<br />  <span class="subsectionToc" >7.4.1 <a 
href="#x1-840001" id="QQ2-1-127">Scenario 1: Managing Multiple Environments</a></span>
<br />  <span class="subsectionToc" >7.4.2 <a 
href="#x1-850002" id="QQ2-1-129">Scenario 2: Rolling Updates</a></span>
<br />  <span class="subsectionToc" >7.4.3 <a 
href="#x1-860003" id="QQ2-1-131">Scenario 3: Scaling Infrastructure</a></span>
<br /> <span class="sectionToc" >7.5 <a 
href="#x1-870005" id="QQ2-1-133">Wrapping Up</a></span>
<br /><span class="chapterToc" >8 <a 
href="#x1-880008" id="QQ2-1-134">Ansible in Action: Practical Use Cases</a></span>
<br /> <span class="sectionToc" >8.1 <a 
href="#x1-890001" id="QQ2-1-135">Deploying a Simple Web Server</a></span>
<br />  <span class="subsectionToc" >8.1.1 <a 
href="#x1-900001" id="QQ2-1-136">Setting Up Nginx</a></span>
<br />  <span class="subsectionToc" >8.1.2 <a 
href="#x1-910002" id="QQ2-1-138">Customizing the Conﬁguration</a></span>
                                                                
                                                                
<br /> <span class="sectionToc" >8.2 <a 
href="#x1-920002" id="QQ2-1-140">Conﬁguring a Database Server</a></span>
<br />  <span class="subsectionToc" >8.2.1 <a 
href="#x1-930001" id="QQ2-1-141">Installing and Securing MySQL</a></span>
<br />  <span class="subsectionToc" >8.2.2 <a 
href="#x1-940002" id="QQ2-1-143">Creating a Database and User</a></span>
<br /> <span class="sectionToc" >8.3 <a 
href="#x1-950003" id="QQ2-1-145">Orchestrating Multiple Services</a></span>
<br />  <span class="subsectionToc" >8.3.1 <a 
href="#x1-960001" id="QQ2-1-146">The Playbook</a></span>
<br />  <span class="subsectionToc" >8.3.2 <a 
href="#x1-970002" id="QQ2-1-148">Breaking It Down</a></span>
<br /> <span class="sectionToc" >8.4 <a 
href="#x1-980004" id="QQ2-1-149">Wrapping Up</a></span>
<br /><span class="chapterToc" >9 <a 
href="#x1-990009" id="QQ2-1-150">Scaling with Dynamic Inventories</a></span>
<br /> <span class="sectionToc" >9.1 <a 
href="#x1-1000001" id="QQ2-1-151">Introduction to Dynamic Inventory Plugins</a></span>
<br />  <span class="subsectionToc" >9.1.1 <a 
href="#x1-1010001" id="QQ2-1-152">How It Works</a></span>
<br />  <span class="subsectionToc" >9.1.2 <a 
href="#x1-1020002" id="QQ2-1-153">Built-In Plugins</a></span>
<br /> <span class="sectionToc" >9.2 <a 
href="#x1-1030002" id="QQ2-1-154">Using AWS Dynamic Inventory</a></span>
<br />  <span class="subsectionToc" >9.2.1 <a 
href="#x1-1040001" id="QQ2-1-155">Installing the Required Tools</a></span>
<br />  <span class="subsectionToc" >9.2.2 <a 
href="#x1-1050002" id="QQ2-1-158">Conﬁguring the Plugin</a></span>
<br />  <span class="subsectionToc" >9.2.3 <a 
href="#x1-1060003" id="QQ2-1-160">Running a Playbook with Dynamic Inventory</a></span>
<br /> <span class="sectionToc" >9.3 <a 
href="#x1-1070003" id="QQ2-1-162">Using GCP Dynamic Inventory</a></span>
<br />  <span class="subsectionToc" >9.3.1 <a 
href="#x1-1080001" id="QQ2-1-163">Installing the GCP SDK</a></span>
<br />  <span class="subsectionToc" >9.3.2 <a 
href="#x1-1090002" id="QQ2-1-165">Conﬁguring the Plugin</a></span>
<br />  <span class="subsectionToc" >9.3.3 <a 
href="#x1-1100003" id="QQ2-1-167">Running a Playbook with GCP Inventory</a></span>
                                                                
                                                                
<br /> <span class="sectionToc" >9.4 <a 
href="#x1-1110004" id="QQ2-1-169">Creating a Custom Dynamic Inventory Script</a></span>
<br />  <span class="subsectionToc" >9.4.1 <a 
href="#x1-1120001" id="QQ2-1-170">The Basics of a Custom Script</a></span>
<br />  <span class="subsectionToc" >9.4.2 <a 
href="#x1-1130002" id="QQ2-1-172">Using the Custom Script</a></span>
<br /> <span class="sectionToc" >9.5 <a 
href="#x1-1140005" id="QQ2-1-175">Why Dynamic Inventories Matter</a></span>
<br /> <span class="sectionToc" >9.6 <a 
href="#x1-1150006" id="QQ2-1-176">Wrapping Up</a></span>
<br /><span class="chapterToc" >10 <a 
href="#x1-11600010" id="QQ2-1-177">Secrets and Security</a></span>
<br /> <span class="sectionToc" >10.1 <a 
href="#x1-1170001" id="QQ2-1-178">Managing Secrets with Ansible Vault</a></span>
<br />  <span class="subsectionToc" >10.1.1 <a 
href="#x1-1180001" id="QQ2-1-179">Creating an Encrypted File</a></span>
<br />  <span class="subsectionToc" >10.1.2 <a 
href="#x1-1190002" id="QQ2-1-182">Viewing and Editing Vault Files</a></span>
<br />  <span class="subsectionToc" >10.1.3 <a 
href="#x1-1200003" id="QQ2-1-185">Using Vault Files in Playbooks</a></span>
<br /> <span class="sectionToc" >10.2 <a 
href="#x1-1210002" id="QQ2-1-188">Writing Secure Playbooks</a></span>
<br />  <span class="subsectionToc" >10.2.1 <a 
href="#x1-1220001" id="QQ2-1-189">Avoid Hardcoding Sensitive Data</a></span>
<br />  <span class="subsectionToc" >10.2.2 <a 
href="#x1-1230002" id="QQ2-1-191">Limit Access with Scoping</a></span>
<br />  <span class="subsectionToc" >10.2.3 <a 
href="#x1-1240003" id="QQ2-1-192">Use Role-Speciﬁc Variables</a></span>
<br />  <span class="subsectionToc" >10.2.4 <a 
href="#x1-1250004" id="QQ2-1-193">Audit Your Playbooks Regularly</a></span>
<br /> <span class="sectionToc" >10.3 <a 
href="#x1-1260003" id="QQ2-1-194">Using Encryption and Limiting Access</a></span>
<br />  <span class="subsectionToc" >10.3.1 <a 
href="#x1-1270001" id="QQ2-1-195">Encrypting Entire Playbooks</a></span>
<br />  <span class="subsectionToc" >10.3.2 <a 
href="#x1-1280002" id="QQ2-1-198">Managing Vault Passwords Securely</a></span>
<br />  <span class="subsectionToc" >10.3.3 <a 
href="#x1-1290003" id="QQ2-1-200">Limiting SSH Access</a></span>
                                                                
                                                                
<br /> <span class="sectionToc" >10.4 <a 
href="#x1-1300004" id="QQ2-1-202">Why Security Matters</a></span>
<br /> <span class="sectionToc" >10.5 <a 
href="#x1-1310005" id="QQ2-1-203">Wrapping Up</a></span>
<br /><span class="chapterToc" >11 <a 
href="#x1-13200011" id="QQ2-1-204">Advanced Ansible Concepts to Explore</a></span>
<br /> <span class="sectionToc" >11.1 <a 
href="#x1-1330001" id="QQ2-1-205">Handlers: Event-Driven Tasks</a></span>
<br />  <span class="subsectionToc" >11.1.1 <a 
href="#x1-1340001" id="QQ2-1-206">When to Use Handlers</a></span>
<br />  <span class="subsectionToc" >11.1.2 <a 
href="#x1-1350002" id="QQ2-1-208">Best Practices for Handlers</a></span>
<br /> <span class="sectionToc" >11.2 <a 
href="#x1-1360002" id="QQ2-1-209">Plugins: Extending Ansible’s Power</a></span>
<br />  <span class="subsectionToc" >11.2.1 <a 
href="#x1-1370001" id="QQ2-1-210">Types of Plugins</a></span>
<br />  <span class="subsectionToc" >11.2.2 <a 
href="#x1-1380002" id="QQ2-1-211">Creating a Custom Filter Plugin</a></span>
<br /> <span class="sectionToc" >11.3 <a 
href="#x1-1390003" id="QQ2-1-214">ansible.cfg: Fine-Tuning Your Environment</a></span>
<br />  <span class="subsectionToc" >11.3.1 <a 
href="#x1-1400001" id="QQ2-1-215">Common Settings</a></span>
<br />  <span class="subsectionToc" >11.3.2 <a 
href="#x1-1410002" id="QQ2-1-217">Tips for Optimizing ansible.cfg</a></span>
<br /> <span class="sectionToc" >11.4 <a 
href="#x1-1420004" id="QQ2-1-218">Molecule: Testing Your Roles</a></span>
<br />  <span class="subsectionToc" >11.4.1 <a 
href="#x1-1430001" id="QQ2-1-219">Setting Up Molecule</a></span>
<br />  <span class="subsectionToc" >11.4.2 <a 
href="#x1-1440002" id="QQ2-1-222">Running Tests</a></span>
<br /> <span class="sectionToc" >11.5 <a 
href="#x1-1450005" id="QQ2-1-224">Mastering Loops</a></span>
<br />  <span class="subsectionToc" >11.5.1 <a 
href="#x1-1460001" id="QQ2-1-225">Using Simple Loops</a></span>
<br />  <span class="subsectionToc" >11.5.2 <a 
href="#x1-1470002" id="QQ2-1-227">Advanced Loops</a></span>
<br /> <span class="sectionToc" >11.6 <a 
href="#x1-1480006" id="QQ2-1-229">Wrapping Up</a></span>
                                                                
                                                                
<br /><span class="chapterToc" >12 <a 
href="#x1-14900012" id="QQ2-1-230">Debugging and Troubleshooting</a></span>
<br /> <span class="sectionToc" >12.1 <a 
href="#x1-1500001" id="QQ2-1-231">Common Issues and How to Fix Them</a></span>
<br />  <span class="subsectionToc" >12.1.1 <a 
href="#x1-1510001" id="QQ2-1-232">Syntax Errors</a></span>
<br />  <span class="subsectionToc" >12.1.2 <a 
href="#x1-1520002" id="QQ2-1-236">Module Not Found</a></span>
<br />  <span class="subsectionToc" >12.1.3 <a 
href="#x1-1530003" id="QQ2-1-238">Connection Issues</a></span>
<br /> <span class="sectionToc" >12.2 <a 
href="#x1-1540002" id="QQ2-1-241">Using Ansible-Playbook with Debug Options</a></span>
<br />  <span class="subsectionToc" >12.2.1 <a 
href="#x1-1550001" id="QQ2-1-242">Verbose Mode</a></span>
<br />  <span class="subsectionToc" >12.2.2 <a 
href="#x1-1560002" id="QQ2-1-244">Debug Module</a></span>
<br />  <span class="subsectionToc" >12.2.3 <a 
href="#x1-1570003" id="QQ2-1-246">Check Mode</a></span>
<br />  <span class="subsectionToc" >12.2.4 <a 
href="#x1-1580004" id="QQ2-1-248">Step Mode</a></span>
<br /> <span class="sectionToc" >12.3 <a 
href="#x1-1590003" id="QQ2-1-250">Testing Changes Safely</a></span>
<br />  <span class="subsectionToc" >12.3.1 <a 
href="#x1-1600001" id="QQ2-1-251">Use a Staging Environment</a></span>
<br />  <span class="subsectionToc" >12.3.2 <a 
href="#x1-1610002" id="QQ2-1-252">Target Speciﬁc Hosts</a></span>
<br />  <span class="subsectionToc" >12.3.3 <a 
href="#x1-1620003" id="QQ2-1-254">Use Check Mode and Diﬀ Mode</a></span>
<br />  <span class="subsectionToc" >12.3.4 <a 
href="#x1-1630004" id="QQ2-1-256">Back Up Before Making Changes</a></span>
<br /> <span class="sectionToc" >12.4 <a 
href="#x1-1640004" id="QQ2-1-258">Why Debugging Matters</a></span>
<br /> <span class="sectionToc" >12.5 <a 
href="#x1-1650005" id="QQ2-1-259">Wrapping Up</a></span>
<br /><span class="chapterToc" >13 <a 
href="#x1-16600013" id="QQ2-1-260">Reﬂections and Next Steps</a></span>
<br /> <span class="sectionToc" >13.1 <a 
href="#x1-1670001" id="QQ2-1-261">Reﬂecting on Simplicity and Automation</a></span>
                                                                
                                                                
<br />  <span class="subsectionToc" >13.1.1 <a 
href="#x1-1680001" id="QQ2-1-262">The Power of Simplicity</a></span>
<br />  <span class="subsectionToc" >13.1.2 <a 
href="#x1-1690002" id="QQ2-1-263">Learning Through Action</a></span>
<br /> <span class="sectionToc" >13.2 <a 
href="#x1-1700002" id="QQ2-1-264">The Art of Balance in IT Automation</a></span>
<br />  <span class="subsectionToc" >13.2.1 <a 
href="#x1-1710001" id="QQ2-1-265">When to Automate</a></span>
<br />  <span class="subsectionToc" >13.2.2 <a 
href="#x1-1720002" id="QQ2-1-266">When Not to Automate</a></span>
<br />  <span class="subsectionToc" >13.2.3 <a 
href="#x1-1730003" id="QQ2-1-267">Iterate and Improve</a></span>
<br /> <span class="sectionToc" >13.3 <a 
href="#x1-1740003" id="QQ2-1-268">Why Balance Matters</a></span>
<br />  <span class="subsectionToc" >13.3.1 <a 
href="#x1-1750001" id="QQ2-1-269">The Human Element</a></span>
<br />  <span class="subsectionToc" >13.3.2 <a 
href="#x1-1760002" id="QQ2-1-270">The Long Game</a></span>
<br /><span class="chapterToc" > <a 
href="#Q1-1-273">About the Author</a></span>
</div>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
<h2 class="chapterHead"><span class="titlemark">Chapter 1</span><br /><a 
 id="x1-80001"></a>Introduction</h2>
<!--l. 3--><p class="noindent" >Automation has become a cornerstone of modern IT, and tools like Ansible
are here to make it simpler, more reliable, and even enjoyable. In this
chapter, we’ll explore the philosophy behind Ansible, why it has
become a go-to tool for engineers, and its core principles: simplicity,
agentless operation, YAML-based conﬁguration, and idempotency. Let’s
dive in and see why Ansible stands out in the crowded world of
automation.
<a 
 id="x1-8001r1"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">1.1    </span> <a 
 id="x1-90001"></a>Philosophy of Simplicity in Automation</h3>
<!--l. 7--><p class="noindent" >Automation tools often promise to solve all your problems, but many come
with steep learning curves, complex setups, or frustrating quirks. Ansible
takes a diﬀerent path–it focuses on simplicity and elegance. Think of it as
the minimalist approach to automation.
</p><!--l. 9--><p class="noindent" >Ansible doesn’t try to reinvent the wheel or overwhelm you with features.
Instead, it oﬀers a straightforward framework where: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 11--><p class="noindent" >You can start small and scale as needed.
      </p></li>
      <li class="itemize">
      <!--l. 12--><p class="noindent" >Conﬁguration ﬁles are easy to read and write.
      </p></li>
      <li class="itemize">
      <!--l. 13--><p class="noindent" >The setup process doesn’t require installing agents or ﬁddling
                                                                
                                                                
      with dependencies.</p></li></ul>
<!--l. 16--><p class="noindent" >In a world where complexity often feels inevitable, Ansible reminds us that
the best solutions are often the simplest. It’s a tool that lets you focus on
what matters: solving problems and delivering value, not debugging your
automation framework.
<a 
 id="x1-9001r14"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">1.2    </span> <a 
 id="x1-100002"></a>What is Ansible, and Why Should You Use It?</h3>
<!--l. 20--><p class="noindent" >At its core, Ansible is an automation engine designed to manage your
infrastructure. Whether you’re deploying applications, conﬁguring servers,
or orchestrating complex workﬂows, Ansible helps you get the job done
with minimal eﬀort.
</p><!--l. 22--><p class="noindent" >Here’s why Ansible stands out: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 24--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Agentless Operation</span>: Unlike many other tools, Ansible doesn’t
      require special software (agents) to be installed on the machines
      it manages. All you need is SSH access, and Ansible handles the
      rest. This makes it incredibly easy to get started.
      </p></li>
      <li class="itemize">
      <!--l. 25--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Human-Readable  Conﬁguration</span>:  Ansible  uses  YAML  (Yet
      Another Markup Language) for its playbooks. YAML is clean,
      simple, and readable even for those who aren’t developers.
      </p></li>
      <li class="itemize">
                                                                
                                                                
      <!--l. 26--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Broad Compatibility</span>: Ansible works with nearly any system,
      from  Linux  to  Windows,  cloud  environments  to  on-premise
      servers. If it can be accessed over SSH or via an API, Ansible
      can probably manage it.</p></li></ul>
<!--l. 29--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Imagine this: You’ve just been handed a dozen new servers to conﬁgure.</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">Instead of logging into each one manually, you write a single Ansible</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">playbook and let it handle the heavy lifting. A process that might</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">take hours–or days–gets reduced to minutes. That’s the power of</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible.</span>
<a 
 id="x1-10001r15"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">1.3    </span> <a 
 id="x1-110003"></a>Core Principles of Ansible</h3>
<!--l. 33--><p class="noindent" >To understand Ansible’s magic, it’s essential to grasp its three core
principles: agentless operation, YAML-based playbooks, and idempotency.
<a 
 id="x1-11001r1"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">1.3.1    </span> <a 
 id="x1-120001"></a>Agentless Operation</h4>
<!--l. 37--><p class="noindent" >When you use Ansible, there’s no need to install agents on the machines
you manage. Instead, Ansible connects to these machines over SSH or via a
Python-based API. This not only reduces setup time but also ensures that
your managed systems stay lightweight and secure.
</p><!--l. 39--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Think of it like this: </span>If you had to ﬁx a leaky faucet, would you want to
carry a toolbox into every room in your house? Of course not. You’d want
to bring just what’s needed. That’s how Ansible works–it keeps
things simple by relying on existing tools (like SSH) to get the job
done.
<a 
 id="x1-12001r17"></a>
                                                                
                                                                
</p>
<h4 class="subsectionHead"><span class="titlemark">1.3.2    </span> <a 
 id="x1-130002"></a>YAML-Based Conﬁguration</h4>
<!--l. 43--><p class="noindent" >YAML is at the heart of Ansible’s playbooks, and it’s one of the reasons the
tool is so beginner-friendly. Playbooks are easy to read and write, even if
you’ve never touched automation before.
</p><!--l. 45--><p class="noindent" >Here’s an example of a simple playbook: </p><!--l. 46-->
<a 
 id="x1-13001r1"></a>
<a 
 id="x1-13002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 1.1:
               </span><span  
class="content">Example
               Playbook:
               Installing
               Apache</span></div><!--tex4ht:label?: x1-13001r1 --><div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-13003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor1"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">installed</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-13009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 56--><p class="noindent" >With YAML, there’s no need for obscure syntax or nested brackets. It’s all
about clarity and readability. You can glance at a playbook and immediately
understand what it’s doing.
<a 
 id="x1-13010r18"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">1.3.3    </span> <a 
 id="x1-140003"></a>Idempotency</h4>
<!--l. 60--><p class="noindent" >Idempotency is a fancy term for a simple idea: running a task multiple
times should produce the same result. If a package is already installed,
Ansible won’t reinstall it. If a ﬁle is already conﬁgured, Ansible won’t
overwrite it. This ensures your systems remain stable and predictable, no
matter how many times you apply your playbook.
                                                                
                                                                
</p><!--l. 62--><p class="noindent" >Here’s an analogy: Imagine painting a wall. Idempotency ensures you
only paint the wall if it hasn’t already been painted. If it’s already
done, you move on to the next task. This prevents waste and ensures
consistency.
<a 
 id="x1-14001r16"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">1.4    </span> <a 
 id="x1-150004"></a>Why Ansible Matters</h3>
<!--l. 66--><p class="noindent" >Ansible isn’t just another tool–it’s a philosophy. It encourages you to
embrace simplicity, trust in automation, and focus on outcomes rather than
processes. Whether you’re managing a single server or orchestrating an
entire data center, Ansible provides a clear, reliable, and scalable path
forward.
</p><!--l. 70--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll get hands-on and explore how to install Ansible,</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">create your ﬁrst playbook, and start automating. The journey to mastering</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">simplicity begins now.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 2</span><br /><a 
 id="x1-160002"></a>Getting Started</h2>
<!--l. 4--><p class="noindent" >Starting with Ansible is easier than you might think. You don’t need a
complex setup or an advanced understanding of automation to get up and
running. This chapter will guide you through the initial steps: installing
Ansible, creating a basic inventory ﬁle, and running your ﬁrst ad-hoc
command. By the end, you’ll have a functional Ansible environment ready
for action.
<a 
 id="x1-16001r21"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">2.1    </span> <a 
 id="x1-170001"></a>Installing Ansible</h3>
<!--l. 8--><p class="noindent" >The ﬁrst step to using Ansible is, of course, installing it. Luckily,
Ansible’s lightweight design makes this process straightforward.
Here’s how you can get started, whether you’re on Linux, macOS, or
Windows.
<a 
 id="x1-17001r20"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">2.1.1    </span> <a 
 id="x1-180001"></a>Installing on Linux</h4>
<!--l. 12--><p class="noindent" >On most Linux distributions, Ansible can be installed directly from your
system’s package manager. For example:
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 15--><p class="noindent" >On Ubuntu or Debian: </p><!--l. 16-->
<a 
 id="x1-18001r1"></a>
<a 
 id="x1-18002"></a>
                                                                
                                                                
        <br />
           <div class="caption" 
><span class="id">Listing 2.1:
           </span><span  
class="content">Install
           Ansible
           on
           Ubuntu/Debian</span></div><!--tex4ht:label?: x1-18001r2 --><div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-18003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apt</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">update</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-18004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apt</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span></div>
        
      </li>
      <li class="itemize">
      <!--l. 21--><p class="noindent" >On CentOS or RHEL: </p><!--l. 22-->
<a 
 id="x1-18005r2"></a>
<a 
 id="x1-18006"></a>
        <br />
           <div class="caption" 
><span class="id">Listing 2.2:
           </span><span  
class="content">Install
           Ansible
           on
           CentOS/RHEL</span></div><!--tex4ht:label?: x1-18005r2 --><div class="lstlisting" id="listing-3"><span class="label"><a 
 id="x1-18007r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dnf</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">epel</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">release</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-18008r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dnf</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span></div>
        
      </li></ul>
<a 
 id="x1-18009r24"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.2    </span> <a 
 id="x1-190002"></a>Installing on macOS</h4>
<!--l. 30--><p class="noindent" >If you’re on macOS, the easiest way to install Ansible is via Homebrew:
</p>
<!--l. 32-->
<a 
 id="x1-19001r3"></a>
<a 
 id="x1-19002"></a>
                                                                
                                                                
  <br />
      <div class="caption" 
><span class="id">Listing 2.3:
      </span><span  
class="content">Install
      Ansible
      on
      macOS</span></div><!--tex4ht:label?: x1-19001r2 --><div class="lstlisting" id="listing-4"><span class="label"><a 
 id="x1-19003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">brew</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span></div>
  
<a 
 id="x1-19004r27"></a>
<h4 class="subsectionHead"><span class="titlemark">2.1.3    </span> <a 
 id="x1-200003"></a>Installing on Windows</h4>
<!--l. 38--><p class="noindent" >For Windows users, the typical approach is to use the Windows
Subsystem for Linux (WSL). Install a Linux distribution via the Microsoft
Store, then follow the Linux installation instructions from within
WSL.
</p><!--l. 40--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Tip: Always check the oﬃcial Ansible documentation for the latest</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">installation instructions for your operating system.</span>
<a 
 id="x1-20001r23"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">2.2    </span> <a 
 id="x1-210002"></a>Setting Up a Basic Inventory File</h3>
<!--l. 44--><p class="noindent" >Ansible needs to know which machines to manage, and this is where the
inventory ﬁle comes in. The inventory ﬁle is a simple text ﬁle listing the
hosts (machines) you want to manage.
<a 
 id="x1-21001r29"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">2.2.1    </span> <a 
 id="x1-220001"></a>Creating Your First Inventory File</h4>
<!--l. 48--><p class="noindent" >Let’s create a basic inventory ﬁle. Open your favorite text editor and create
a ﬁle called <span 
class="pcrr8t-x-x-120">inventory </span>in your project directory.
                                                                
                                                                
</p><!--l. 50--><p class="noindent" >Here’s an example of what your inventory ﬁle might look like: </p><!--l. 51-->
<a 
 id="x1-22001r4"></a>
<a 
 id="x1-22002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 2.4:
      </span><span  
class="content">Basic
      Inventory
      File</span></div><!--tex4ht:label?: x1-22001r2 --><div class="lstlisting" id="listing-5"><span class="label"><a 
 id="x1-22003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.101</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.102</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">databases</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.201</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-22009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.202</span></span></div>
  
<!--l. 61--><p class="noindent" >In this example: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 63--><p class="noindent" ><span 
class="pcrr8t-x-x-120">webservers </span>and <span 
class="pcrr8t-x-x-120">databases </span>are groups of hosts.
      </p></li>
      <li class="itemize">
      <!--l. 64--><p class="noindent" >Each host is listed by its IP address or hostname.</p></li></ul>
<a 
 id="x1-22010r31"></a>
<h4 class="subsectionHead"><span class="titlemark">2.2.2    </span> <a 
 id="x1-230002"></a>Using Variables in the Inventory File</h4>
<!--l. 69--><p class="noindent" >Ansible inventory ﬁles can also include variables, allowing you to
customize how tasks are executed for speciﬁc hosts. For example:
</p>
<!--l. 71-->
<a 
 id="x1-23001r5"></a>
<a 
 id="x1-23002"></a>
                                                                
                                                                
  <br />
      <div class="caption" 
><span class="id">Listing 2.5:
      </span><span  
class="content">Inventory
      File
      with
      Variables</span></div><!--tex4ht:label?: x1-23001r2 --><div class="lstlisting" id="listing-6"><span class="label"><a 
 id="x1-23003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.101</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">admin</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_ssh_port</span></span><span style="color:#000000"><span 
class="pcrr8t-">=2222</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.102</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">admin</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_ssh_port</span></span><span style="color:#000000"><span 
class="pcrr8t-">=2222</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">databases</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.201</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">root</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-23009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.202</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">root</span></span></div>
  
<!--l. 81--><p class="noindent" >Here, we specify SSH users and ports for each host. Ansible uses this
information to connect and execute tasks.
</p><!--l. 83--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Tip: Store your inventory ﬁle in a Git repository to track changes and</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">collaborate with your team.</span>
<a 
 id="x1-23010r30"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">2.3    </span> <a 
 id="x1-240003"></a>Running Your First Ad-Hoc Command</h3>
<!--l. 87--><p class="noindent" >Now that Ansible is installed and your inventory ﬁle is set up, it’s time to
run your ﬁrst command. Ansible supports “ad-hoc” commands, which are
one-oﬀ tasks executed directly from the command line.
<a 
 id="x1-24001r33"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">2.3.1    </span> <a 
 id="x1-250001"></a>Testing Connectivity</h4>
<!--l. 91--><p class="noindent" >Let’s start by testing connectivity to the hosts in your inventory ﬁle. Run the
following command: </p><!--l. 92-->
<a 
 id="x1-25001r6"></a>
<a 
 id="x1-25002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 2.6:
      </span><span  
class="content">Ping
                                                                
                                                                
      All
      Hosts
      in
      Inventory</span></div><!--tex4ht:label?: x1-25001r2 --><div class="lstlisting" id="listing-7"><span class="label"><a 
 id="x1-25003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">ping</span></span></div>
  
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 97--><p class="noindent" ><span 
class="pcrr8t-x-x-120">all</span>: Targets all hosts in the inventory ﬁle.
      </p></li>
      <li class="itemize">
      <!--l. 98--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-i inventory</span>: Speciﬁes the inventory ﬁle to use.
      </p></li>
      <li class="itemize">
      <!--l. 99--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-m ansible.builtin.ping</span>:                Uses                the
      <span 
class="pcrr8t-x-x-120">ansible.builtin.ping </span>module to test connectivity.</p></li></ul>
<!--l. 102--><p class="noindent" >If everything is set up correctly, you’ll see a response like this: </p><!--l. 103-->
<a 
 id="x1-25004r7"></a>
<a 
 id="x1-25005"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 2.7:
      </span><span  
class="content">Ping
      Command
      Output</span></div><!--tex4ht:label?: x1-25004r2 --><div class="lstlisting" id="listing-8"><span class="label"><a 
 id="x1-25006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.101</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">|</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">SUCCESS</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25007r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">changed</span></span><span style="color:#000000"><span 
class="pcrr8t-">":</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">false</span></span><span style="color:#000000"><span 
class="pcrr8t-">,</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25008r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">ping</span></span><span style="color:#000000"><span 
class="pcrr8t-">":</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">pong</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25009r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25010r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.102</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">|</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">SUCCESS</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=&gt;</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25011r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">changed</span></span><span style="color:#000000"><span 
class="pcrr8t-">":</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">false</span></span><span style="color:#000000"><span 
class="pcrr8t-">,</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25012r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">ping</span></span><span style="color:#000000"><span 
class="pcrr8t-">":</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">pong</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-25013r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span></div>
  
<a 
 id="x1-25014r36"></a>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">2.3.2    </span> <a 
 id="x1-260002"></a>Executing a Command</h4>
<!--l. 116--><p class="noindent" >Next, let’s run a simple shell command on all the hosts. For example, to
check the date on each machine: </p><!--l. 117-->
<a 
 id="x1-26001r8"></a>
<a 
 id="x1-26002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 2.8:
      </span><span  
class="content">Run
      Shell
      Command
      with
      Ansible</span></div><!--tex4ht:label?: x1-26001r2 --><div class="lstlisting" id="listing-9"><span class="label"><a 
 id="x1-26003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">shell</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">date</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span></div>
  
<!--l. 121--><p class="noindent" >In this command: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 123--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-m ansible.builtin.shell</span>:            Speciﬁes            the
      <span 
class="pcrr8t-x-x-120">ansible.builtin.shell </span>module.
      </p></li>
      <li class="itemize">
      <!--l. 124--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-a "date"</span>: Passes the <span 
class="pcrr8t-x-x-120">date </span>command as an argument.</p></li></ul>
<!--l. 127--><p class="noindent" >You’ll see the current date and time from each host.
<a 
 id="x1-26004r39"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">2.3.3    </span> <a 
 id="x1-270003"></a>Installing a Package</h4>
<!--l. 131--><p class="noindent" >Finally, let’s install a package (e.g., <span 
class="pcrr8t-x-x-120">htop</span>) on the <span 
class="pcrr8t-x-x-120">webservers </span>group:
                                                                
                                                                
</p><!--l. 132-->
<a 
 id="x1-27001r9"></a>
<a 
 id="x1-27002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 2.9:
      </span><span  
class="content">Install
      a
      Package</span></div><!--tex4ht:label?: x1-27001r2 --><div class="lstlisting" id="listing-10"><span class="label"><a 
 id="x1-27003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">htop</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span></div>
  
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 137--><p class="noindent" ><span 
class="pcrr8t-x-x-120">webservers</span>: Targets only the <span 
class="pcrr8t-x-x-120">webservers </span>group.
      </p></li>
      <li class="itemize">
      <!--l. 138--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-m ansible.builtin.package</span>:
      Uses the <span 
class="pcrr8t-x-x-120">ansible.builtin.package </span>module for package
      management.
      </p></li>
      <li class="itemize">
      <!--l. 139--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-a "name=htop state=present"</span>:       Speciﬁes       the
      package name and desired state.</p></li></ul>
<a 
 id="x1-27004r35"></a>
<h3 class="sectionHead"><span class="titlemark">2.4    </span> <a 
 id="x1-280004"></a>Wrapping Up</h3>
<!--l. 144--><p class="noindent" >Congratulations! You’ve installed Ansible, set up an inventory ﬁle, and
run your ﬁrst ad-hoc commands. These small steps might not seem
revolutionary, but they form the foundation for powerful automation
workﬂows.
                                                                
                                                                
</p><!--l. 148--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll dive into playbooks. Ansible’s true strength and</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">learn how to write and execute them for repeatable and scalable</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">automation.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 3</span><br /><a 
 id="x1-290003"></a>Ansible Basics: Understanding Playbooks</h2>
<!--l. 3--><p class="noindent" >You’ve dipped your toes into the waters of Ansible with ad-hoc commands.
It’s cool, sure–but it’s only the beginning. The real magic happens with
playbooks. Playbooks are the <span 
class="ntx-Bold-tlf-t1-x-x-120">A</span>rchitects of Ansible, the backbone of your
automation. They turn your one-oﬀ commands into reusable, scalable
workﬂows.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll break down what playbooks and tasks are, guide you
through writing your ﬁrst playbook, and introduce core modules like <span 
class="pcrr8t-x-x-120">file</span>,
<span 
class="pcrr8t-x-x-120">copy</span>, and <span 
class="pcrr8t-x-x-120">service</span>. By the end, you’ll feel like you’ve just unlocked the
next level of automation.
<a 
 id="x1-29001r43"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">3.1    </span> <a 
 id="x1-300001"></a>What are Playbooks and Tasks?</h3>
<!--l. 9--><p class="noindent" >Think of a playbook as a <span 
class="ntx-Bold-tlf-t1-x-x-120">N</span>arrative for your automation. It’s a step-by-step
story of what you want Ansible to do, written in YAML. Each chapter
of the story is a task, and each task tells Ansible what action to
take.
</p><!--l. 11--><p class="noindent" >Here’s the cool part: Playbooks are human-readable. They don’t hide
behind cryptic syntax. A quick glance, and you’ll know exactly what’s
happening.
</p><!--l. 13--><p class="noindent" >Here’s what a simple playbook might look like: </p><!--l. 14-->
<a 
 id="x1-30001r1"></a>
<a 
 id="x1-30002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 3.1:
               </span><span  
class="content">Example
                                                                
                                                                
               Playbook:
               Basic
               Setup</span></div><!--tex4ht:label?: x1-30001r3 --><div class="lstlisting" id="listing-11"><span class="label"><a 
 id="x1-30003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">exists</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor2"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">tmp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-30009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span></div>
  
<!--l. 24--><p class="noindent" >In this example: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 26--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">name </span>ﬁeld describes what each step does. It’s purely for
      your beneﬁt (and your teammates’ sanity).
      </p></li>
      <li class="itemize">
      <!--l. 27--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">file </span>module is the hero here, ensuring the directory exists.
      </p></li>
      <li class="itemize">
      <!--l. 28--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">tasks </span>section contains all the individual actions you want
      to perform.</p></li></ul>
<!--l. 31--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Think of it this way: A playbook is your orchestra, and each task is an</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">instrument. Together, they create a symphony of automation.</span>
<a 
 id="x1-30010r45"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">3.2    </span> <a 
 id="x1-310002"></a>Writing Your First Playbook</h3>
<!--l. 35--><p class="noindent" >Let’s write a <span 
class="ntx-Bold-tlf-t1-x-x-120">s</span>imple playbook to create a directory, copy a ﬁle into it, and
ensure a service is running. Open your favorite text editor and create a ﬁle
called <span 
class="pcrr8t-x-x-120">example-playbook.yml</span>.
</p><!--l. 37--><p class="noindent" >Here’s what it might look like: </p><!--l. 38-->
                                                                
                                                                
<a 
 id="x1-31001r2"></a>
<a 
 id="x1-31002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 3.2:
               </span><span  
class="content">Your
               First
               Playbook</span></div><!--tex4ht:label?: x1-31001r3 --><div class="lstlisting" id="listing-12"><span class="label"><a 
 id="x1-31003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Basic</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Setup</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor3"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">tmp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor4"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Copy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">txt</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">tmp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">txt</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor5"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">running</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-31019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span></div>
  
<!--l. 58--><p class="noindent" >Let’s break it down: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 60--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">ansible.builtin.file </span>module creates a directory.
      </p></li>
      <li class="itemize">
      <!--l. 61--><p class="noindent" >The  <span 
class="pcrr8t-x-x-120">ansible.builtin.copy </span>module  moves  a  ﬁle  from
      your control node to the target machine.
      </p></li>
      <li class="itemize">
      <!--l. 62--><p class="noindent" >The   <span 
class="pcrr8t-x-x-120">ansible.builtin.service </span>module   ensures   the
      Apache service is running. (Because no one likes a stopped web
      server.)</p></li></ul>
<a 
 id="x1-31020r41"></a>
<h4 class="subsectionHead"><span class="titlemark">3.2.1    </span> <a 
 id="x1-320001"></a>Running the Playbook</h4>
<!--l. 67--><p class="noindent" >To run your playbook, use the <span 
class="pcrr8t-x-x-120">ansible-playbook </span>command:
</p><!--l. 68-->
                                                                
                                                                
<a 
 id="x1-32001r3"></a>
<a 
 id="x1-32002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 3.3:
      </span><span  
class="content">Running
      Your
      Playbook</span></div><!--tex4ht:label?: x1-32001r3 --><div class="lstlisting" id="listing-13"><span class="label"><a 
 id="x1-32003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 72--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">B</span>ask in the glory of automation as Ansible executes each task. You’ll see
output detailing what’s happening, including what’s changed.
<a 
 id="x1-32004r47"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">3.3    </span> <a 
 id="x1-330003"></a>Core Modules: File, Copy, Service</h3>
<!--l. 76--><p class="noindent" >Modules are like <span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>ngredients in your automation recipe. Ansible provides
hundreds of them, but for now, we’ll focus on three essential ones: <span 
class="pcrr8t-x-x-120">file</span>,
<span 
class="pcrr8t-x-x-120">copy</span>, and <span 
class="pcrr8t-x-x-120">service</span>.
<a 
 id="x1-33001r49"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">3.3.1    </span> <a 
 id="x1-340001"></a><span 
class="pcrr8t-x-x-120">file</span></h4>
<!--l. 80--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">file </span>module is your go-to for managing ﬁles and directories. You can
use it to create, delete, or modify ﬁles and directories. Here’s an example:
</p><!--l. 81-->
<a 
 id="x1-34001r4"></a>
<a 
 id="x1-34002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 3.4:
          </span><span  
class="content">Using
          the
                                                                
                                                                
          File
          Module</span></div><!--tex4ht:label?: x1-34001r3 --><div class="lstlisting" id="listing-14"><span class="label"><a 
 id="x1-34003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">exists</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-34004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-34005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-34006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span></div>
  
<a 
 id="x1-34007r52"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.2    </span> <a 
 id="x1-350002"></a><span 
class="pcrr8t-x-x-120">copy</span></h4>
<!--l. 90--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">copy </span>module lets you copy ﬁles from your control node to the
managed machines. It’s great for deploying conﬁguration ﬁles, scripts, or
static assets.
</p><!--l. 92--><p class="noindent" >Example: </p><!--l. 93-->
<a 
 id="x1-35001r5"></a>
<a 
 id="x1-35002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 3.5:
          </span><span  
class="content">Using
          the
          Copy
          Module</span></div><!--tex4ht:label?: x1-35001r3 --><div class="lstlisting" id="listing-15"><span class="label"><a 
 id="x1-35003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Copy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-35004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-35005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-35006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span></div>
  
<a 
 id="x1-35007r54"></a>
<h4 class="subsectionHead"><span class="titlemark">3.3.3    </span> <a 
 id="x1-360003"></a><span 
class="pcrr8t-x-x-120">service</span></h4>
<!--l. 102--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">service </span>module ensures that services (like Apache or Nginx) are
started, stopped, or restarted. It’s your <span 
class="ntx-Bold-tlf-t1-x-x-120">L</span>oyal ally in managing system
services.
</p><!--l. 104--><p class="noindent" >Example: </p><!--l. 105-->
<a 
 id="x1-36001r6"></a>
<a 
 id="x1-36002"></a>
                                                                
                                                                
  <br />
          <div class="caption" 
><span class="id">Listing 3.6:
          </span><span  
class="content">Using
          the
          Service
          Module</span></div><!--tex4ht:label?: x1-36001r3 --><div class="lstlisting" id="listing-16"><span class="label"><a 
 id="x1-36003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-36004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-36005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-36006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-36007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span></div>
  
<!--l. 113--><p class="noindent" >Here, <span 
class="pcrr8t-x-x-120">enabled: yes </span>ensures the service starts automatically on
reboot.
<a 
 id="x1-36008r51"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">3.4    </span> <a 
 id="x1-370004"></a>Wrapping Up</h3>
<!--l. 117--><p class="noindent" >Congratulations! You’ve written and executed your ﬁrst playbook, learned
about tasks, and explored three core modules. Playbooks are the heart of
Ansible, turning individual commands into cohesive, reusable automation
workﬂows.
</p><!--l. 121--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Here’s a little secret: Every playbook you write from here on out will be a</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">step closer to automation mastery. So keep experimenting, keep reﬁning,</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">and let simplicity guide your journey.</span>
</p><!--l. 125--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">E</span>very great adventure starts with a single playbook. Are you ready to
explore more? In the next chapter, we’ll dive deeper into variables and
templates, taking your automation skills to the next level.
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 4</span><br /><a 
 id="x1-380004"></a>Thinking Like Ansible: Idempotence and Simplicity</h2>
<!--l. 3--><p class="noindent" >Ansible isn’t just a tool–it’s a way of thinking. It’s a mindset rooted <span 
class="ntx-Bold-tlf-t1-x-x-120">i</span>n
simplicity and clarity. If you’ve ever wished your to-do list could magically
ﬁnish itself without <span 
class="ntx-Bold-tlf-t1-x-x-120">d</span>uplication, you already understand one of Ansible’s
superpowers: <span 
class="ntx-Bold-tlf-t1-x-x-120">idempotence</span>.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll talk about why idempotence is the backbone of
Ansible and how you can write tasks that align with its philosophy. By the
end, you’ll start thinking like Ansibl<span 
class="ntx-Bold-tlf-t1-x-x-120">e</span>: clear, consistent, and, above all,
simple.
<a 
 id="x1-38001r58"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">4.1    </span> <a 
 id="x1-390001"></a>Why Idempotence Matters</h3>
<!--l. 9--><p class="noindent" >Let’s get one thing straight: idempotence sounds fancy, but it’s not. It’s a
simple idea that saves you from headaches. When a task is idempotent,
running it multiple times doesn’t mess anything up. It brings your system
to the <span 
class="ntx-Bold-tlf-t1-x-x-120">desired state</span>, no matter how many times you hit the play
button.
</p><!--l. 11--><p class="noindent" >Imagine you’re packing for a trip. You check your bag and see you already
packed your toothbrush. Do you add another one? Nope. You skip it and
move on. That’s idempotence. It ensures you only do what’s necessary–no
more, no less.
</p><!--l. 13--><p class="noindent" >Without idempotence, your playbooks could become <span 
class="ntx-Bold-tlf-t1-x-x-120">m</span>essy and
unpredictable. Imagine installing a <span 
class="ntx-Bold-tlf-t1-x-x-120">p</span>ackage ten times, creating duplicate
ﬁles, or starting a service that’s already running. At best, it wastes time. At
worst, it breaks things.
                                                                
                                                                
</p><!--l. 15--><p class="noindent" >Idempotence makes automation safe, predictable, and repeatable. It’s
Ansible’s way <span 
class="ntx-Bold-tlf-t1-x-x-120">o</span>f saying, “Relax, I’ve got this.”
<a 
 id="x1-39001r60"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">4.2    </span> <a 
 id="x1-400002"></a>Writing Idempotent Tasks</h3>
<!--l. 19--><p class="noindent" >When writing Ansible tasks, the goal is always the same: describe <span 
class="ntx-Bold-tlf-t1-x-x-120">t</span>he
desired state, not the steps to get there. Let’s break this down with some
examples.
<a 
 id="x1-40001r56"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">4.2.1    </span> <a 
 id="x1-410001"></a>Installing a Package</h4>
<!--l. 23--><p class="noindent" >Let’s say you want to install the <span 
class="pcrr8t-x-x-120">htop </span>package. Here’s how you might write
a task: </p><!--l. 24-->
<a 
 id="x1-41001r1"></a>
<a 
 id="x1-41002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 4.1:
          </span><span  
class="content">Installing
          a
          Package</span></div><!--tex4ht:label?: x1-41001r4 --><div class="lstlisting" id="listing-17"><span class="label"><a 
 id="x1-41003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">htop</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">installed</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-41004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-41005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">htop</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-41006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 31--><p class="noindent" >Notice the magic in <span 
class="pcrr8t-x-x-120">state: present</span>. Ansible checks if <span 
class="pcrr8t-x-x-120">htop </span>is
already installed. If it is, it does nothing. If it’s not, it installs it. Either way,
you end up with <span 
class="ntx-Bold-tlf-t1-x-x-120">one </span><span 
class="pcrr8t-x-x-120">htop</span>, no duplicates, no drama.
<a 
 id="x1-41007r62"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">4.2.2    </span> <a 
 id="x1-420002"></a>Creating a Directory</h4>
<!--l. 35--><p class="noindent" >Now, let’s create a directory. Simple, right? Here’s how: </p><!--l. 36-->
<a 
 id="x1-42001r2"></a>
<a 
 id="x1-42002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 4.2:
          </span><span  
class="content">Creating
          a
          Directory</span></div><!--tex4ht:label?: x1-42001r4 --><div class="lstlisting" id="listing-18"><span class="label"><a 
 id="x1-42003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">for</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">logs</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-42004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-42005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-42006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span></div>
  
<!--l. 43--><p class="noindent" >If the directory <span 
class="ntx-Bold-tlf-t1-x-x-120">e</span>xists, Ansible moves on. If it doesn’t, Ansible creates it.
You don’t have to care about what’s already there–Ansible handles
it.
<a 
 id="x1-42007r64"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">4.2.3    </span> <a 
 id="x1-430003"></a>Starting a Service</h4>
<!--l. 47--><p class="noindent" >Starting a service might seem like a no-brainer, but idempotence takes it a
step further: </p><!--l. 48-->
<a 
 id="x1-43001r3"></a>
<a 
 id="x1-43002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 4.3:
          </span><span  
class="content">Starting
          a
          Service</span></div><!--tex4ht:label?: x1-43001r4 --><div class="lstlisting" id="listing-19"><span class="label"><a 
 id="x1-43003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-43004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-43005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-43006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-43007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span></div>
  
<!--l. 56--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">service </span>module ensures two things: 1. The service is running
(<span 
class="pcrr8t-x-x-120">state: started</span>). 2. The service will start automatically on boot
                                                                
                                                                
(<span 
class="pcrr8t-x-x-120">enabled: yes</span>).
</p><!--l. 60--><p class="noindent" >If Nginx is already running, Ansible doesn’t restart it unnecessarily. If it’s
<span 
class="ntx-Bold-tlf-t1-x-x-120">n</span>ot, Ansible starts it. Clean, eﬃcient, and idempotent.
<a 
 id="x1-43008r61"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">4.3    </span> <a 
 id="x1-440003"></a>Idempotence in Practice</h3>
<!--l. 64--><p class="noindent" >Here’s a quick exercise: think about a task you’ve done manually before.
Maybe it’s adding a user to a server, setting permissions on a ﬁle, or
updating a conﬁguration. Now imagine doing it 50 times, across 50
servers.
</p><!--l. 66--><p class="noindent" >Would you trust yourself to get it right every time? Probably not. That’s
where idempotence <span 
class="ntx-Bold-tlf-t1-x-x-120">c</span>omes in. With Ansible, you don’t have to remember
the state of every server. You just write tasks that describe the end goal, and
Ansible does the heavy lifting.
</p><!--l. 68--><p class="noindent" >Here’s an example playbook that ties it all together: </p><!--l. 69-->
<a 
 id="x1-44001r4"></a>
<a 
 id="x1-44002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 4.4:
               </span><span  
class="content">Idempotence
               in
               Action</span></div><!--tex4ht:label?: x1-44001r4 --><div class="lstlisting" id="listing-20"><span class="label"><a 
 id="x1-44003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">servers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor6"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">installed</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor7"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">logs</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor8"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Apache</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apache2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-44020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span></div>
  
<!--l. 90--><p class="noindent" >Run this playbook once or a hundred times. The result will always be the
same: Apache installed, the logs directory created, and the service
running.
<a 
 id="x1-44021r68"></a>
                                                                
                                                                
</p>
<h3 class="sectionHead"><span class="titlemark">4.4    </span> <a 
 id="x1-450004"></a>The Philosophy of Simplicity</h3>
<!--l. 94--><p class="noindent" >Idempotence is part of Ansible’s bigger picture: keeping things simple.
Simplicity doesn’t mean “basic” or “limited.” It means focusing on what
matters and removing what doesn’t.
</p><!--l. 96--><p class="noindent" >Here are some tips to keep your playbooks simple: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 98--><p class="noindent" >Use clear, descriptive names for tasks.
      </p></li>
      <li class="itemize">
      <!--l. 99--><p class="noindent" >Avoid hardcoding values–use variables instead.
      </p></li>
      <li class="itemize">
      <!--l. 100--><p class="noindent" >Break complex tasks into smaller, focused playbooks.
      </p></li>
      <li class="itemize">
      <!--l. 101--><p class="noindent" >Trust Ansible’s modules to handle the details.</p></li></ul>
<!--l. 104--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Remember: simplicity isn’t just a feature of Ansible. It’s a way of working, a</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">way of thinking, and a way of automating.</span>
<a 
 id="x1-45001r70"></a>
</p>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">4.5    </span> <a 
 id="x1-460005"></a>Wrapping Up</h3>
<!--l. 108--><p class="noindent" >Idempotence isn’t just a t<span 
class="ntx-Bold-tlf-t1-x-x-120">e</span>chnical term–it’s a mindset. It’s about writing
tasks that do what’s needed, nothing more, nothing less. It’s about
trusting Ansible to handle the details, so you can focus on the bigger
picture.
</p><!--l. 110--><p class="noindent" >When you start thinking like Ansible, you’ll ﬁnd yourself writing cleaner,
simpler, and more eﬀective playbooks. And that’s not just good for your
automation–it’s good for your sanity.
</p><!--l. 115--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore variables and templates–tools that let you</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">customize and adapt your playbooks to any situation. Get ready to take your</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">automation skills to the next level.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 5</span><br /><a 
 id="x1-470005"></a>Your First Workﬂow: Automating Everyday Tasks</h2>
<!--l. 3--><p class="noindent" >So, you’ve learned about tasks, playbooks, and the magic of idempotence.
Now it’s time to put them to work. Let’s dive into creating your ﬁrst
workﬂow–a playbook that automates the everyday tasks you’re probably
already doing manually: installing packages, managing ﬁles and directories,
and conﬁguring services.
</p><!--l. 5--><p class="noindent" >By the end of this chapter, you’ll have a practical playbook you can tweak
and expand. More importantly, you’ll start seeing Ansible not just as a
tool, but as your personal assistant that never gets tired or misses a
step.
<a 
 id="x1-47001r71"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-480001"></a>Automating Package Installations</h3>
<!--l. 9--><p class="noindent" >Let’s start with something simple: installing packages. It’s one of the most
common tasks in system administration. With Ansible, it’s not just easy–it’s
eﬀortless.
<a 
 id="x1-48001r66"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.1.1    </span> <a 
 id="x1-490001"></a>Installing One Package</h4>
<!--l. 13--><p class="noindent" >Suppose you need to install <span 
class="pcrr8t-x-x-120">htop</span>, a handy tool for monitoring system
resources. Here’s how you’d write that task: </p><!--l. 14-->
<a 
 id="x1-49001r1"></a>
<a 
 id="x1-49002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.1:
                                                                
                                                                
          </span><span  
class="content">Installing
          a
          Single
          Package</span></div><!--tex4ht:label?: x1-49001r5 --><div class="lstlisting" id="listing-21"><span class="label"><a 
 id="x1-49003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Ensure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">htop</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">installed</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-49004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-49005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">htop</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-49006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 21--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">W</span>ith this one-liner, Ansible checks if <span 
class="pcrr8t-x-x-120">htop </span>is already installed. If it is, it
does nothing. If it’s not, it installs it. Simple, right?
<a 
 id="x1-49007r74"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.1.2    </span> <a 
 id="x1-500002"></a>Installing Multiple Packages</h4>
<!--l. 25--><p class="noindent" >What if you want to install several packages at once? No problem. Just list
them: </p><!--l. 26-->
<a 
 id="x1-50001r2"></a>
<a 
 id="x1-50002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.2:
          </span><span  
class="content">Installing
          Multiple
          Packages</span></div><!--tex4ht:label?: x1-50001r5 --><div class="lstlisting" id="listing-22"><span class="label"><a 
 id="x1-50003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">essential</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor9"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">curl</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor10"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">git</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor11"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">vim</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-50009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 36--><p class="noindent" >Here, Ansible ensures all three packages–<span 
class="pcrr8t-x-x-120">curl</span>, <span 
class="pcrr8t-x-x-120">git</span>, and <span 
class="pcrr8t-x-x-120">vim</span>–are
installed. Whether you’re managing one server or one hundred, the process
is the same.
<a 
 id="x1-50010r76"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">5.1.3    </span> <a 
 id="x1-510003"></a>A Quick Reality Check</h4>
<!--l. 40--><p class="noindent" >Imagine doing this manually on ten servers. You’d SSH into each one, run
commands, and double-check your work. Boring. Error-prone. Now,
imagine handing the job to Ansible. You write the playbook once, run it,
and let Ansible handle the rest. That’s automation.
<a 
 id="x1-51001r73"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">5.2    </span> <a 
 id="x1-520002"></a>Managing Files and Directories</h3>
<!--l. 44--><p class="noindent" >Next up: ﬁles and directories. Creating, deleting, or modifying them is a
breeze with Ansible.
<a 
 id="x1-52001r78"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.2.1    </span> <a 
 id="x1-530001"></a>Creating Directories</h4>
<!--l. 48--><p class="noindent" >Let’s say you need a directory to store log ﬁles. Here’s the task:
</p><!--l. 49-->
<a 
 id="x1-53001r3"></a>
<a 
 id="x1-53002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.3:
          </span><span  
class="content">Creating
          a
          Directory</span></div><!--tex4ht:label?: x1-53001r5 --><div class="lstlisting" id="listing-23"><span class="label"><a 
 id="x1-53003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">logs</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-53004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-53005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-53006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-53007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’0755’</span></span></div>
  
<!--l. 57--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">O</span>ne task, one directory. Notice the <span 
class="pcrr8t-x-x-120">mode </span>ﬁeld? It sets permissions for the
directory, ensuring it’s accessible to the right users.
<a 
 id="x1-53008r80"></a>
                                                                
                                                                
</p>
<h4 class="subsectionHead"><span class="titlemark">5.2.2    </span> <a 
 id="x1-540002"></a>Managing Files</h4>
<!--l. 61--><p class="noindent" >Want to create or delete ﬁles? Use the same <span 
class="pcrr8t-x-x-120">file </span>module: </p><!--l. 62-->
<a 
 id="x1-54001r4"></a>
<a 
 id="x1-54002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.4:
          </span><span  
class="content">Creating
          or
          Deleting
          Files</span></div><!--tex4ht:label?: x1-54001r5 --><div class="lstlisting" id="listing-24"><span class="label"><a 
 id="x1-54003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yaml</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">touch</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Delete</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">an</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">old</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">old</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-54011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">absent</span></span></div>
  
<!--l. 74--><p class="noindent" >In the ﬁrst task, <span 
class="pcrr8t-x-x-120">state: touch </span>ensures the ﬁle exists (and creates it if it
doesn’t). In the second, <span 
class="pcrr8t-x-x-120">state: absent </span>deletes the ﬁle.
<a 
 id="x1-54012r82"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.2.3    </span> <a 
 id="x1-550003"></a>Copying Files</h4>
<!--l. 78--><p class="noindent" >Sometimes you need to deploy a ﬁle to your servers. The <span 
class="pcrr8t-x-x-120">copy </span>module
makes this easy: </p><!--l. 79-->
<a 
 id="x1-55001r5"></a>
<a 
 id="x1-55002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.5:
          </span><span  
class="content">Copying
          a
          File</span></div><!--tex4ht:label?: x1-55001r5 --><div class="lstlisting" id="listing-25"><span class="label"><a 
 id="x1-55003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-55004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-55005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yaml</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-55006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yaml</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-55007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’0644’</span></span></div>
  
                                                                
                                                                
<!--l. 87--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">R</span>un this task, and Ansible copies <span 
class="pcrr8t-x-x-120">config.yaml </span>from your local machine
to the target servers. It even sets the correct permissions.
<a 
 id="x1-55008r79"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">5.3    </span> <a 
 id="x1-560003"></a>Conﬁguring Services</h3>
<!--l. 91--><p class="noindent" >Finally, let’s talk about services. Whether it’s a web server, a database, or
a background job, managing services is a critical part of system
administration. With Ansible, it’s also ridiculously simple.
<a 
 id="x1-56001r84"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.3.1    </span> <a 
 id="x1-570001"></a>Starting and Enabling Services</h4>
<!--l. 95--><p class="noindent" >Here’s how to ensure a service (like Nginx) is running and starts
automatically on boot: </p><!--l. 96-->
<a 
 id="x1-57001r6"></a>
<a 
 id="x1-57002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.6:
          </span><span  
class="content">Starting
          and
          Enabling
          a
          Service</span></div><!--tex4ht:label?: x1-57001r5 --><div class="lstlisting" id="listing-26"><span class="label"><a 
 id="x1-57003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-57004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-57005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-57006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-57007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span></div>
  
<!--l. 104--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">K</span>nowing your services are running and set to restart on boot is a good
night’s sleep in YAML form.
<a 
 id="x1-57008r87"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">5.3.2    </span> <a 
 id="x1-580002"></a>Restarting Services</h4>
<!--l. 108--><p class="noindent" >Need to restart a service after changing its conﬁguration? Here’s how:
</p><!--l. 109-->
<a 
 id="x1-58001r7"></a>
<a 
 id="x1-58002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 5.7:
          </span><span  
class="content">Restarting
          a
          Service</span></div><!--tex4ht:label?: x1-58001r5 --><div class="lstlisting" id="listing-27"><span class="label"><a 
 id="x1-58003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restart</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-58004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-58005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-58006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">restarted</span></span></div>
  
<!--l. 116--><p class="noindent" >This task ensures the service stops and starts cleanly, applying any
changes.
<a 
 id="x1-58007r89"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">5.3.3    </span> <a 
 id="x1-590003"></a>Combining Tasks for a Workﬂow</h4>
<!--l. 120--><p class="noindent" >Let’s put everything together. Here’s a playbook that installs Nginx, sets up
a logs directory, deploys a conﬁguration ﬁle, and ensures the service is
running: </p><!--l. 121-->
<a 
 id="x1-59001r8"></a>
<a 
 id="x1-59002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 5.8:
               </span><span  
class="content">A
               Complete
               Workﬂow</span></div><!--tex4ht:label?: x1-59001r5 --><div class="lstlisting" id="listing-28"><span class="label"><a 
 id="x1-59003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor12"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor13"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">logs</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’0755’</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor14"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59021r19"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">19</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’0644’</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59022r20"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">20</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59023r21"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">21</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor15"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59024r22"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">22</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59025r23"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">23</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59026r24"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">24</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-59027r25"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">25</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span></div>
  
<a 
 id="x1-59028r86"></a>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">5.4    </span> <a 
 id="x1-600004"></a>Why Workﬂows Matter</h3>
<!--l. 151--><p class="noindent" >Workﬂows are the backbone of automation. They take your tasks from
one-oﬀ commands to cohesive, repeatable processes. With workﬂows,
you’re not just automating–you’re orchestrating.
</p><!--l. 153--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">F</span>or example, think about setting up a new server. Instead of juggling SSH
sessions and commands, you run a playbook. In minutes, your server is
ready, conﬁgured exactly how you want it.
</p><!--l. 156--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">L</span>ike a great symphony, workﬂows bring harmony to your automation.
They’re not just eﬃcient–they’re beautiful.
<a 
 id="x1-60001r93"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">5.5    </span> <a 
 id="x1-610005"></a>Wrapping Up</h3>
<!--l. 160--><p class="noindent" >Congratulations! You’ve written your ﬁrst workﬂow, tackled everyday tasks,
and seen the power of Ansible in action. Automation isn’t just about saving
time–it’s about working smarter, not harder.
</p><!--l. 162--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">O</span>nce you start building <span 
class="ntx-Bold-tlf-t1-x-x-120">w</span>orkﬂows, you’ll never want to go back to the
manual way. And the best part? You’ve only scratched the surface. Ansible
can handle so much more.
</p><!--l. 166--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll dive into roles–your secret weapon for</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">keeping playbooks organized and reusable. Ready to level up? Let’s</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 6</span><br /><a 
 id="x1-620006"></a>Building a Foundation: Roles and Reusability</h2>
<!--l. 3--><p class="noindent" >When your playbooks start to grow, so does the complexity. At some
point, you’ll look at a playbook and think, “There’s got to be a better
way to organize this.” That’s where <span 
class="ntx-Bold-tlf-t1-x-x-120">R</span>oles come in. Think of roles
as Ansible’s way of saying, “Let’s clean up this mess and make it
reusable.”
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll explore what roles are, how to structure your projects
for clarity, and how to use Ansible Galaxy to jump-start your automation.
By the end, you’ll have the foundation to build playbooks that are
organized, scalable, and downright elegant.
<a 
 id="x1-62001r94"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">6.1    </span> <a 
 id="x1-630001"></a>Introduction to Roles</h3>
<!--l. 9--><p class="noindent" >Let’s start with a simple analogy: If a playbook is a recipe, a role is your
pre-measured set of ingredients. It’s a way to group related tasks, variables,
ﬁles, and templates into a reusable package. With roles, you can stop
copying and pasting tasks between playbooks and start reusing them
instead.
</p><!--l. 11--><p class="noindent" >Here’s how roles simplify your life: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 13--><p class="noindent" >They  group  tasks  logically  (e.g.,  everything  related  to  a  web
      server).
      </p></li>
      <li class="itemize">
                                                                
                                                                
      <!--l. 14--><p class="noindent" >They keep your project tidy by organizing ﬁles and variables.
      </p></li>
      <li class="itemize">
      <!--l. 15--><p class="noindent" >They make your playbooks shorter, easier to read, and easier to
      maintain.</p></li></ul>
<a 
 id="x1-63001r91"></a>
<h4 class="subsectionHead"><span class="titlemark">6.1.1    </span> <a 
 id="x1-640001"></a>Anatomy of a Role</h4>
<!--l. 20--><p class="noindent" >A role has a speciﬁc directory structure. It looks like this:
                                                                
                                                                
</p>
<pre class="verbatim" id="verbatim-1">
roles/
  myrole/
    tasks/
      main.yml
    vars/
      main.yml
    files/
    templates/
    handlers/
      main.yml
</pre>
<!--l. 32--><p class="nopar" >
</p><!--l. 34--><p class="noindent" >Each directory has a purpose: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 36--><p class="noindent" ><span 
class="pcrr8t-x-x-120">tasks/</span>: Stores the tasks your role will execute.
      </p></li>
      <li class="itemize">
      <!--l. 37--><p class="noindent" ><span 
class="pcrr8t-x-x-120">vars/</span>: Contains variables speciﬁc to the role.
      </p></li>
      <li class="itemize">
      <!--l. 38--><p class="noindent" ><span 
class="pcrr8t-x-x-120">files/</span>: Holds static ﬁles you want to copy to managed nodes.
                                                                
                                                                
      </p></li>
      <li class="itemize">
      <!--l. 39--><p class="noindent" ><span 
class="pcrr8t-x-x-120">templates/</span>:    Houses    Jinja2    templates    for    dynamic
      conﬁguration.
      </p></li>
      <li class="itemize">
      <!--l. 40--><p class="noindent" ><span 
class="pcrr8t-x-x-120">handlers/</span>:   Deﬁnes   tasks   that   respond   to   events   (e.g.,
      restarting a service).</p></li></ul>
<!--l. 43--><p class="noindent" >Think of it as a toolbox, where every tool has its place. Once you’ve set up
your role, it’s reusable across any playbook.
<a 
 id="x1-64001r96"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">6.2    </span> <a 
 id="x1-650002"></a>Structuring Your Projects for Clarity</h3>
<!--l. 47--><p class="noindent" >Roles thrive in an organized project. Without structure, even the best role
can feel like ﬁnding a needle in a haystack.
<a 
 id="x1-65001r97"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">6.2.1    </span> <a 
 id="x1-660001"></a>The Big Picture</h4>
<!--l. 51--><p class="noindent" >Here’s a sample project layout with roles:
                                                                
                                                                
</p>
<pre class="verbatim" id="verbatim-2">
project/
  site.yml
  inventory/
  group_vars/
  roles/
    webserver/
    database/
</pre>
<!--l. 60--><p class="nopar" >
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 63--><p class="noindent" ><span 
class="pcrr8t-x-x-120">site.yml</span>: Your main playbook that ties everything together.
      </p></li>
      <li class="itemize">
      <!--l. 64--><p class="noindent" ><span 
class="pcrr8t-x-x-120">inventory/</span>: Deﬁnes the hosts and groups you’re managing.
      </p></li>
      <li class="itemize">
      <!--l. 65--><p class="noindent" ><span 
class="pcrr8t-x-x-120">group_vars/</span>: Contains variables for host groups.
      </p></li>
      <li class="itemize">
      <!--l. 66--><p class="noindent" ><span 
class="pcrr8t-x-x-120">roles/</span>: Holds all your roles.</p></li></ul>
                                                                
                                                                
<!--l. 69--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">O</span>ne of the best things about this structure is clarity. You know exactly
where to look for tasks, variables, or ﬁles.
<a 
 id="x1-66001r99"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">6.2.2    </span> <a 
 id="x1-670002"></a>Using Roles in a Playbook</h4>
<!--l. 73--><p class="noindent" >Here’s how you’d use a role in a playbook: </p><!--l. 74-->
<a 
 id="x1-67001r1"></a>
<a 
 id="x1-67002"></a>
  <br />
         <div class="caption" 
><span class="id">Listing 6.1:
         </span><span  
class="content">Using
         a
         Role
         in
         a
         Playbook</span></div><!--tex4ht:label?: x1-67001r6 --><div class="lstlisting" id="listing-29"><span class="label"><a 
 id="x1-67003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">servers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-67004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-67005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">roles</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-67006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor16"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">webserver</span></span></div>
  
<!--l. 81--><p class="noindent" >That’s it. Instead of writing out all the tasks in the playbook, you simply
reference the role. Ansible handles the rest.
</p><!--l. 83--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Tip: Roles can depend on each other. If your web server role needs</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">to conﬁgure a ﬁrewall ﬁrst, you can set role dependencies in</span>
<span 
class="pcrro8t-x-x-120">meta/main.yml</span><span 
class="ntx-Italic-tlf-t1-x-x-120">.</span>
<a 
 id="x1-67007r98"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">6.3    </span> <a 
 id="x1-680003"></a>Using Ansible Galaxy</h3>
<!--l. 87--><p class="noindent" >Ansible Galaxy is like a treasure trove of roles created by the community.
It’s an online repository where you can download and share roles for
                                                                
                                                                
common tasks.
<a 
 id="x1-68001r100"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">6.3.1    </span> <a 
 id="x1-690001"></a>Installing a Role</h4>
<!--l. 91--><p class="noindent" >Let’s say you need a role to install Nginx. Instead of writing it yourself, you
can grab one from Galaxy: </p><!--l. 92-->
<a 
 id="x1-69001r2"></a>
<a 
 id="x1-69002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 6.2:
      </span><span  
class="content">Installing
      a
      Role
      from
      Ansible
      Galaxy</span></div><!--tex4ht:label?: x1-69001r6 --><div class="lstlisting" id="listing-30"><span class="label"><a 
 id="x1-69003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">galaxy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">geerlingguy</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span></div>
  
<!--l. 96--><p class="noindent" >This downloads the role to your <span 
class="pcrr8t-x-x-120">roles/ </span>directory. You can use it in your
playbook just like any other role: </p><!--l. 97-->
<a 
 id="x1-69004r3"></a>
<a 
 id="x1-69005"></a>
  <br />
         <div class="caption" 
><span class="id">Listing 6.3:
         </span><span  
class="content">Using
         a
         Galaxy
         Role</span></div><!--tex4ht:label?: x1-69004r6 --><div class="lstlisting" id="listing-31"><span class="label"><a 
 id="x1-69006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-69007r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-69008r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">roles</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-69009r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor17"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">geerlingguy</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span></div>
  
<a 
 id="x1-69010r103"></a>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">6.3.2    </span> <a 
 id="x1-700002"></a>Creating Your Own Galaxy Role</h4>
<!--l. 106--><p class="noindent" >If you want to create a role and share it on Galaxy, you can start with the
following command: </p><!--l. 107-->
<a 
 id="x1-70001r4"></a>
<a 
 id="x1-70002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 6.4:
      </span><span  
class="content">Creating
      a
      New
      Role</span></div><!--tex4ht:label?: x1-70001r6 --><div class="lstlisting" id="listing-32"><span class="label"><a 
 id="x1-70003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">galaxy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">init</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">myrole</span></span></div>
  
<!--l. 111--><p class="noindent" >This generates the directory structure we discussed earlier. From
there, it’s just a matter of adding tasks, variables, and ﬁles. Once
you’re happy with your role, you can upload it to Galaxy to help
others.
<a 
 id="x1-70004r102"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">6.4    </span> <a 
 id="x1-710004"></a>Why Roles Matter</h3>
<!--l. 115--><p class="noindent" >Roles aren’t just about organization–they’re about scalability. As your
infrastructure grows, you’ll need playbooks that can keep up. Roles let you
write once and reuse everywhere. They make collaboration easier, too.
<span 
class="ntx-Bold-tlf-t1-x-x-120">L</span>et’s face it: handing someone a clean, modular role is much nicer than
saying, “Good luck with this 500-line playbook.”
</p><!--l. 117--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Think of roles as your automation superpower. The more you use them, the</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">more time you save.</span>
<a 
 id="x1-71001r108"></a>
</p>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">6.5    </span> <a 
 id="x1-720005"></a>Wrapping Up</h3>
<!--l. 121--><p class="noindent" >You’ve just unlocked one of Ansible’s most powerful features: roles. They
keep your playbooks clean, your projects organized, and your life easier.
Whether you’re managing one server or one thousand, roles scale with
you.
</p><!--l. 123--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">E</span>ven better, with tools like Ansible Galaxy, you can tap into a community
of automation experts and share your work with others.
</p><!--l. 127--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll dive into variables and templates–tools that make</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">your playbooks dynamic and adaptable. Ready to take your automation to</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">the next level? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 7</span><br /><a 
 id="x1-730007"></a>Working with Variables, Facts, and Templates</h2>
<!--l. 3--><p class="noindent" >Ansible’s magic lies in its simplicity, but sometimes you need a little extra
ﬂexibility. That’s where variables, facts, and templates come in. They let
you tailor your playbooks to diﬀerent scenarios without duplicating code or
conﬁgurations. Think of them as Ansible’s way of saying, &#x0022;Let’s keep this
DRY–Don’t Repeat Yourself.&#x0022;
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll explore: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 7--><p class="noindent" >How to use variables and facts to make your playbooks dynamic.
      </p></li>
      <li class="itemize">
      <!--l. 8--><p class="noindent" >Creating Jinja2 templates for dynamic conﬁguration ﬁles.
      </p></li>
      <li class="itemize">
      <!--l. 9--><p class="noindent" >Practical use cases where these tools shine.</p></li></ul>
<!--l. 12--><p class="noindent" >By the end, you’ll have the skills to write playbooks that adapt to whatever
challenges you throw at them.
<a 
 id="x1-73001r109"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">7.1    </span> <a 
 id="x1-740001"></a>Working with Variables</h3>
<!--l. 17--><p class="noindent" >Variables in Ansible are like <span 
class="ntx-Bold-tlf-t1-x-x-120">V</span>ersatile placeholders. Instead of hardcoding
values, you use variables to deﬁne dat<span 
class="ntx-Bold-tlf-t1-x-x-120">a </span>that might change, like server
names, ﬁle paths, or user credentials.
                                                                
                                                                
<a 
 id="x1-74001r106"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.1.1    </span> <a 
 id="x1-750001"></a>Deﬁning Variables</h4>
<!--l. 21--><p class="noindent" >You can deﬁne variables in several places: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 23--><p class="noindent" >Directly in your playbooks.
      </p></li>
      <li class="itemize">
      <!--l. 24--><p class="noindent" >In inventory ﬁles.
      </p></li>
      <li class="itemize">
      <!--l. 25--><p class="noindent" >In separate variable ﬁles.</p></li></ul>
<!--l. 28--><p class="noindent" >Here’s an example of deﬁning variables in a playbook: </p><!--l. 29-->
<a 
 id="x1-75001r1"></a>
<a 
 id="x1-75002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 7.1:
               </span><span  
class="content">Deﬁning
               Variables
               in
               a
               Playbook</span></div><!--tex4ht:label?: x1-75001r7 --><div class="lstlisting" id="listing-33"><span class="label"><a 
 id="x1-75003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">vars</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">app_name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MyCoolApp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">log_dir</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">mycoolapp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor18"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">a</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">log_dir</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-75014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mode</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’0755’</span></span></div>
  
<!--l. 44--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Note</span>: Variables are wrapped in double curly braces (<span class="obeylines-h"><span class="verb"><span 
class="pcrr8t-x-x-120">{{</span><span 
class="pcrr8t-x-x-120"> }}</span></span></span>) whenever you
reference them. It’s Ansible’s way of saying, &#x0022;Hey, I’m a variable!&#x0022;
<a 
 id="x1-75015r112"></a>
                                                                
                                                                
</p>
<h4 class="subsectionHead"><span class="titlemark">7.1.2    </span> <a 
 id="x1-760002"></a>Using Group and Host Variables</h4>
<!--l. 48--><p class="noindent" >Sometimes you need variables that apply to speciﬁc groups or hosts. That’s
where group and host variables come in. You deﬁne them in the
<span 
class="pcrr8t-x-x-120">group_vars/ </span>or <span 
class="pcrr8t-x-x-120">host_vars/ </span>directories.
</p><!--l. 50--><p class="noindent" >For example, in <span 
class="pcrr8t-x-x-120">group_vars/webservers.yml</span>: </p><!--l. 51-->
<a 
 id="x1-76001r2"></a>
<a 
 id="x1-76002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 7.2:
      </span><span  
class="content">Group
      Variables</span></div><!--tex4ht:label?: x1-76001r7 --><div class="lstlisting" id="listing-34"><span class="label"><a 
 id="x1-76003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">app_name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MyCoolApp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-76004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">log_dir</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">mycoolapp</span></span></div>
  
<!--l. 56--><p class="noindent" >These va<span 
class="ntx-Bold-tlf-t1-x-x-120">r</span>iables automatically apply to any host in the <span 
class="pcrr8t-x-x-120">webservers</span>
group.
<a 
 id="x1-76005r114"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.1.3    </span> <a 
 id="x1-770003"></a>Overriding Variables</h4>
<!--l. 60--><p class="noindent" >Variables are ﬂexible, and Ansible lets you override them at diﬀerent levels.
If a variable is deﬁned in multiple places, the one closest to the task
wins. <span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>nventory variables override group variables, which override
playbook variables. It’s a hierarchy that ensures you can ﬁne-tune your
conﬁguration.
<a 
 id="x1-77001r111"></a>
</p>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">7.2    </span> <a 
 id="x1-780002"></a>Using Facts</h3>
<!--l. 65--><p class="noindent" >Facts are Ansible’s way of gathering information about your managed hosts.
When you run a playbook, Ansible automatically collects facts–like the
operating system, IP addresses, or available memory. These facts are stored
as variables you can use in your playbooks.
<a 
 id="x1-78001r116"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.2.1    </span> <a 
 id="x1-790001"></a>Viewing Facts</h4>
<!--l. 69--><p class="noindent" >To see what facts Ansible collects, run this command: </p><!--l. 70-->
<a 
 id="x1-79001r3"></a>
<a 
 id="x1-79002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 7.3:
      </span><span  
class="content">Viewing
      Host
      Facts</span></div><!--tex4ht:label?: x1-79001r7 --><div class="lstlisting" id="listing-35"><span class="label"><a 
 id="x1-79003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">setup</span></span></div>
  
<!--l. 74--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">A </span>ﬂood of information will appear, but don’t worry–you don’t need to
memorize it. You can reference any fact in your playbooks.
</p><!--l. 76--><p class="noindent" >For example, to print the hostname of a managed machine: </p><!--l. 77-->
<a 
 id="x1-79004r4"></a>
<a 
 id="x1-79005"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 7.4:
               </span><span  
class="content">Using
               a
               Fact
               in
               a
                                                                
                                                                
               Playbook</span></div><!--tex4ht:label?: x1-79004r7 --><div class="lstlisting" id="listing-36"><span class="label"><a 
 id="x1-79006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Print</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">the</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">hostname</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-79007r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-79008r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-79009r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor19"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Display</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">the</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">hostname</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-79010r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">debug</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-79011r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">msg</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">Hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span></div>
  
<!--l. 86--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">B</span>y using facts, your playbooks become smarter, adapting to each host’s
speciﬁc environment.
<a 
 id="x1-79012r117"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">7.3    </span> <a 
 id="x1-800003"></a>Jinja2 Templates for Dynamic Conﬁguration Files</h3>
<!--l. 91--><p class="noindent" >Sometimes, you need more than variables and facts. You need dynamic
conﬁguration ﬁles that adapt to your environment. That’s where Jinja2
templates come in.
<a 
 id="x1-80001r118"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.3.1    </span> <a 
 id="x1-810001"></a>Creating a Template</h4>
<!--l. 95--><p class="noindent" >Templates are simple text ﬁles with placeholders for variables. Here’s an
example <span 
class="pcrr8t-x-x-120">nginx.conf.j2 </span>ﬁle: </p><!--l. 96-->
<a 
 id="x1-81001r5"></a>
<a 
 id="x1-81002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 7.5:
      </span><span  
class="content">Jinja2
      Template
      for
      Nginx</span></div><!--tex4ht:label?: x1-81001r7 --><div class="lstlisting" id="listing-37"><span class="label"><a 
 id="x1-81003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-81004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">listen</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">80;</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-81005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">server_name</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}};</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-81006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">root</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">www</span></span><span style="color:#000000"><span 
class="pcrr8t-">/{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">app_name</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}};</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-81007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span></div>
  
<!--l. 104--><p class="noindent" >Notice how we use variables (<span 
class="pcrr8t-x-x-120">{{ ansible_hostname }} </span>and <span 
class="pcrr8t-x-x-120">{{</span>
<span 
class="pcrr8t-x-x-120">app_name }}</span>) to make the ﬁle dynamic.
<a 
 id="x1-81008r122"></a>
                                                                
                                                                
</p>
<h4 class="subsectionHead"><span class="titlemark">7.3.2    </span> <a 
 id="x1-820002"></a>Deploying a Template</h4>
<!--l. 108--><p class="noindent" >To use a template in your playbook, use the <span 
class="pcrr8t-x-x-120">template </span>module:
</p><!--l. 109-->
<a 
 id="x1-82001r6"></a>
<a 
 id="x1-82002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 7.6:
          </span><span  
class="content">Deploying
          a
          Template</span></div><!--tex4ht:label?: x1-82001r7 --><div class="lstlisting" id="listing-38"><span class="label"><a 
 id="x1-82003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-82004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">template</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-82005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">j2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-82006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span></div>
  
<!--l. 116--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">L</span>ike the <span 
class="pcrr8t-x-x-120">copy </span>module, the <span 
class="pcrr8t-x-x-120">template </span>module transfers the ﬁle to the
target host. The diﬀerence? It processes the variables ﬁrst, so you get a fully
customized conﬁguration ﬁle.
<a 
 id="x1-82007r121"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">7.4    </span> <a 
 id="x1-830004"></a>Ansible in Action: Practical Use Cases</h3>
<!--l. 121--><p class="noindent" >Let’s tie it all together with some real-world examples. Here are three
scenarios where variables, facts, and templates make life easier.
<a 
 id="x1-83001r124"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.4.1    </span> <a 
 id="x1-840001"></a>Scenario 1: Managing Multiple Environments</h4>
<!--l. 125--><p class="noindent" >Imagine you’re deploying an application to staging and production
environments. Each environment has diﬀerent conﬁgurations, but the tasks
are the same. Here’s how you’d handle it: </p><!--l. 126-->
                                                                
                                                                
<a 
 id="x1-84001r7"></a>
<a 
 id="x1-84002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 7.7:
               </span><span  
class="content">Playbook
               for
               Multiple
               Environments</span></div><!--tex4ht:label?: x1-84001r7 --><div class="lstlisting" id="listing-39"><span class="label"><a 
 id="x1-84003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">vars</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">app_env</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">group_names</span></span><span style="color:#000000"><span 
class="pcrr8t-">[0]</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">db_host</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">app_env</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}-</span></span><span style="color:#000000"><span 
class="pcrr8t-">db</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">example</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">com</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor20"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">template</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">app_config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">j2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-84013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 140--><p class="noindent" >In this playbook, we use variables and facts to dynamically conﬁgure the
database host based on the environment.
<a 
 id="x1-84014r127"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">7.4.2    </span> <a 
 id="x1-850002"></a>Scenario 2: Rolling Updates</h4>
<!--l. 144--><p class="noindent" >Need to update web servers one at a time to avoid downtime? Ansible’s
variables and facts make this easy: </p><!--l. 145-->
<a 
 id="x1-85001r8"></a>
<a 
 id="x1-85002"></a>
  <br />
             <div class="caption" 
><span class="id">Listing 7.8:
             </span><span  
class="content">Rolling
             Updates
             Playbook</span></div><!--tex4ht:label?: x1-85001r7 --><div class="lstlisting" id="listing-40"><span class="label"><a 
 id="x1-85003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Rolling</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">update</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">of</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">servers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-85004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-85005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">serial</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">1</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-85006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-85007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor21"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Update</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-85008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">shell</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">deploy_app</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">sh</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span></div>
  
<!--l. 154--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">E</span>ach server is updated in sequence, ensuring your service stays
online.
<a 
 id="x1-85009r129"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">7.4.3    </span> <a 
 id="x1-860003"></a>Scenario 3: Scaling Infrastructure</h4>
<!--l. 158--><p class="noindent" >When scaling infrastructure, templates save you from manually editing
conﬁguration ﬁles: </p><!--l. 159-->
<a 
 id="x1-86001r9"></a>
<a 
 id="x1-86002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 7.9:
               </span><span  
class="content">Scaling
               Infrastructure
               Playbook</span></div><!--tex4ht:label?: x1-86001r7 --><div class="lstlisting" id="listing-41"><span class="label"><a 
 id="x1-86003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Add</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">new</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">servers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">new_webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor22"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">load</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">balancer</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">template</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">lb_config</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">j2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-86009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">sites</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">default</span></span></div>
  
<!--l. 169--><p class="noindent" >With a dynamic template, your load balancer automatically updates to
include the new servers.
<a 
 id="x1-86010r126"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">7.5    </span> <a 
 id="x1-870005"></a>Wrapping Up</h3>
<!--l. 174--><p class="noindent" >Variables, facts, and templates are the heart of Ansible’s ﬂexibility. They let
you adapt your playbooks to any environment, saving time and reducing
errors. Whether you’re deploying an app, conﬁguring a service,
or scaling your infrastructure, these tools make automation feel
eﬀortless.
</p><!--l. 178--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore dynamic inventories and how they can</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">make managing complex environments even easier. Ready to keep leveling</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">up? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 8</span><br /><a 
 id="x1-880008"></a>Ansible in Action: Practical Use Cases</h2>
<!--l. 3--><p class="noindent" >The theory is great, but let’s be honest–seeing Ansible in action is where
the magic happens. In this chapter, we’ll roll up our sleeves and tackle three
real-world scenarios: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 5--><p class="noindent" >Deploying a simple web server (like Nginx or Apache).
      </p></li>
      <li class="itemize">
      <!--l. 6--><p class="noindent" >Conﬁguring a database server.
      </p></li>
      <li class="itemize">
      <!--l. 7--><p class="noindent" >Orchestrating multiple services to work together seamlessly.</p></li></ul>
<!--l. 10--><p class="noindent" >By the end of this chapter, you’ll have practical playbooks you can use,
adapt, and expand for your own needs. Let’s get to it.
<a 
 id="x1-88001r133"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">8.1    </span> <a 
 id="x1-890001"></a>Deploying a Simple Web Server</h3>
<!--l. 15--><p class="noindent" >Let’s start with something straightforward: deploying a web server.
Whether you’re serving a static site or acting as a reverse proxy, tools like
Nginx and Apache are staples in any sysadmin’s toolkit.
<a 
 id="x1-89001r131"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">8.1.1    </span> <a 
 id="x1-900001"></a>Setting Up Nginx</h4>
<!--l. 19--><p class="noindent" >Here’s a playbook to install and conﬁgure Nginx on a group of web servers:
</p><!--l. 20-->
<a 
 id="x1-90001r1"></a>
<a 
 id="x1-90002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 8.1:
               </span><span  
class="content">Playbook
               for
               Nginx
               Deployment</span></div><!--tex4ht:label?: x1-90001r8 --><div class="lstlisting" id="listing-42"><span class="label"><a 
 id="x1-90003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">become</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">true</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor23"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor24"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor25"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">template</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90021r19"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">19</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">j2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90022r20"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">20</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90023r21"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">21</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90024r22"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">22</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor26"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restart</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">to</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apply</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">changes</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90025r23"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">23</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90026r24"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">24</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-90027r25"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">25</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">restarted</span></span></div>
  
<!--l. 48--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">A </span>few key things are happening here: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 50--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">apt </span>module ensures Nginx is installed.
      </p></li>
      <li class="itemize">
      <!--l. 51--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">service </span>module makes sure it’s running and enabled at
      boot.
      </p></li>
      <li class="itemize">
      <!--l. 52--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">template </span>module deploys a custom conﬁguration ﬁle.
      </p></li>
      <li class="itemize">
      <!--l. 53--><p class="noindent" >Finally, Nginx is restarted to apply any changes.</p></li></ul>
<a 
 id="x1-90028r136"></a>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">8.1.2    </span> <a 
 id="x1-910002"></a>Customizing the Conﬁguration</h4>
<!--l. 58--><p class="noindent" >Here’s an example <span 
class="pcrr8t-x-x-120">nginx.conf.j2 </span>template: </p><!--l. 59-->
<a 
 id="x1-91001r2"></a>
<a 
 id="x1-91002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 8.2:
      </span><span  
class="content">Custom
      Nginx
      Conﬁguration
      Template</span></div><!--tex4ht:label?: x1-91001r8 --><div class="lstlisting" id="listing-43"><span class="label"><a 
 id="x1-91003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">listen</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">80;</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">server_name</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}};</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">root</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">www</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">html</span></span><span style="color:#000000"><span 
class="pcrr8t-">;</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">location</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">try_files</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">$uri</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">$uri</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=404;</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-91011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span></div>
  
<!--l. 71--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">C</span>onﬁgure it once, and it works across all your web servers. Ansible
replaces <span 
class="pcrr8t-x-x-120">{{ ansible_hostname }} </span>with each server’s hostname
dynamically.
<a 
 id="x1-91012r135"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">8.2    </span> <a 
 id="x1-920002"></a>Conﬁguring a Database Server</h3>
<!--l. 76--><p class="noindent" >Databases are the backbone of many applications. Let’s conﬁgure a MySQL
server to handle incoming requests reliably.
<a 
 id="x1-92001r138"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">8.2.1    </span> <a 
 id="x1-930001"></a>Installing and Securing MySQL</h4>
<!--l. 80--><p class="noindent" >Here’s a playbook to install and secure MySQL: </p><!--l. 81-->
<a 
 id="x1-93001r3"></a>
<a 
 id="x1-93002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 8.3:
                                                                
                                                                
               </span><span  
class="content">Playbook
               for
               MySQL
               Server
               Conﬁguration</span></div><!--tex4ht:label?: x1-93001r8 --><div class="lstlisting" id="listing-44"><span class="label"><a 
 id="x1-93003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MySQL</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dbservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">become</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">true</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor27"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MySQL</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">mysql</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor28"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">enable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MySQL</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">mysql</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor29"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Secure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">MySQL</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">installation</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">command</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span id="textcolor30"><span 
class="pcrr8t-">&gt;</span></span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93021r19"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">19</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mysql_secure_installation</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-93022r20"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">20</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">use</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">default</span></span></div>
  
<!--l. 104--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">T</span>his setup ensures MySQL is installed, running, and secure. You can
enhance it further by using Ansible modules to manage users and
databases.
<a 
 id="x1-93023r141"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">8.2.2    </span> <a 
 id="x1-940002"></a>Creating a Database and User</h4>
<!--l. 108--><p class="noindent" >Let’s create a database and a user: </p><!--l. 109-->
<a 
 id="x1-94001r4"></a>
<a 
 id="x1-94002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 8.4:
               </span><span  
class="content">Create
               Database
               and
               User</span></div><!--tex4ht:label?: x1-94001r8 --><div class="lstlisting" id="listing-45"><span class="label"><a 
 id="x1-94003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">and</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">user</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dbservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">become</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">true</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor31"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mysql_db</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor32"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">user</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mysql_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">appuser</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">secretpassword</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">priv</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">.*:</span></span><span style="color:#000000"><span 
class="pcrr8t-">ALL</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-94018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 128--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>n just a few lines, you’ve set up a database, created a user, and assigned
permissions. No manual SQL commands needed.
<a 
 id="x1-94019r140"></a>
</p>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">8.3    </span> <a 
 id="x1-950003"></a>Orchestrating Multiple Services</h3>
<!--l. 133--><p class="noindent" >Now for the fun part: making everything work together. Let’s deploy a
web application that uses Nginx as the frontend and MySQL as the
backend.
<a 
 id="x1-95001r143"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">8.3.1    </span> <a 
 id="x1-960001"></a>The Playbook</h4>
<!--l. 137--><p class="noindent" >Here’s how you can orchestrate multiple services in a single playbook:
</p><!--l. 138-->
<a 
 id="x1-96001r5"></a>
<a 
 id="x1-96002"></a>
  <br />
              <div class="caption" 
><span class="id">Listing 8.5:
              </span><span  
class="content">Orchestrating
              Web
              and
              Database
              Services</span></div><!--tex4ht:label?: x1-96001r8 --><div class="lstlisting" id="listing-46"><span class="label"><a 
 id="x1-96003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">web</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">become</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">true</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor33"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">required</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor34"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor35"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">mysql</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">server</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor36"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">template</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">j2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor37"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96021r19"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">19</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mysql_db</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96022r20"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">20</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96023r21"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">21</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96024r22"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">22</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96025r23"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">23</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor38"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">user</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96026r24"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">24</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">mysql_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96027r25"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">25</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">appuser</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96028r26"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">26</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">secretpassword</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96029r27"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">27</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">priv</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">myapp</span></span><span style="color:#000000"><span 
class="pcrr8t-">.*:</span></span><span style="color:#000000"><span 
class="pcrr8t-">ALL</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96030r28"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">28</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96031r29"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">29</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96032r30"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">30</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor39"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">services</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96033r31"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">31</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96034r32"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">32</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">item</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96035r33"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">33</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96036r34"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">34</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">yes</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96037r35"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">35</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">with_items</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96038r36"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">36</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor40"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-96039r37"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">37</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor41"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">mysql</span></span></div>
  
<a 
 id="x1-96040r146"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3.2    </span> <a 
 id="x1-970002"></a>Breaking It Down</h4>
<!--l. 180--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">O</span>ne playbook, two services: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 182--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">apt </span>module installs both Nginx and MySQL.
      </p></li>
                                                                
                                                                
      <li class="itemize">
      <!--l. 183--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">template </span>module deploys the Nginx conﬁguration.
      </p></li>
      <li class="itemize">
      <!--l. 184--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">mysql_db </span>and <span 
class="pcrr8t-x-x-120">mysql_user </span>modules handle database
      setup.
      </p></li>
      <li class="itemize">
      <!--l. 185--><p class="noindent" >Finally, the <span 
class="pcrr8t-x-x-120">with_items </span>loop ensures both services are started
      and enabled.</p></li></ul>
<!--l. 188--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">N</span>ow you’ve got a fully functional web application with a database backend,
deployed automatically. It’s eﬃcient, repeatable, and scalable.
<a 
 id="x1-97001r145"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">8.4    </span> <a 
 id="x1-980004"></a>Wrapping Up</h3>
<!--l. 193--><p class="noindent" >You’ve just seen Ansible in action, tackling real-world problems like
deploying web servers, conﬁguring databases, and orchestrating services.
These examples are just the beginning. The more you use Ansible, the more
you’ll discover its potential.
</p><!--l. 196--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore dynamic inventories to make managing</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">complex environments even easier. Ready to dive deeper? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 9</span><br /><a 
 id="x1-990009"></a>Scaling with Dynamic Inventories</h2>
<!--l. 3--><p class="noindent" >When your infrastructure grows from a handful of servers to hundreds–or
even thousands–keeping track of them manually becomes impossible.
That’s where dynamic inventories come in. They’re like Ansible’s way of
saying, “Don’t worry, I’ve got this.”
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll cover: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 7--><p class="noindent" >What dynamic inventories are and why they’re awesome.
      </p></li>
      <li class="itemize">
      <!--l. 8--><p class="noindent" >How to use dynamic inventory plugins with cloud providers like
      AWS and GCP.
      </p></li>
      <li class="itemize">
      <!--l. 9--><p class="noindent" >Creating a custom dynamic inventory script for unique use cases.</p></li></ul>
<!--l. 12--><p class="noindent" >By the end, you’ll feel like a scaling superhero, ready to automate with
conﬁdence no matter how large your infrastructure gets.
<a 
 id="x1-99001r149"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.1    </span> <a 
 id="x1-1000001"></a>Introduction to Dynamic Inventory Plugins</h3>
<!--l. 17--><p class="noindent" >Let’s start with the basics: What is a dynamic inventory? A static inventory
is just a text ﬁle where you manually list your servers. It’s great for small
                                                                
                                                                
setups but falls apart when servers are constantly coming and going. A
dynamic inventory, on the other hand, generates this list automatically
based on your environment.
</p><!--l. 19--><p class="noindent" >Think of it like a smart grocery list. Instead of you writing down every item,
your fridge just knows what you need.
<a 
 id="x1-100001r148"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">9.1.1    </span> <a 
 id="x1-1010001"></a>How It Works</h4>
<!--l. 23--><p class="noindent" >Dynamic inventory plugins integrate with your infrastructure to fetch the
current state of your resources. Whether you’re running on AWS, GCP, or
something else, these plugins can: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 25--><p class="noindent" >Fetch all your instances and group them by tags or regions.
      </p></li>
      <li class="itemize">
      <!--l. 26--><p class="noindent" >Update the inventory in real time, so you’re never working with
      outdated data.
      </p></li>
      <li class="itemize">
      <!--l. 27--><p class="noindent" >Scale eﬀortlessly as you add or remove servers.</p></li></ul>
<!--l. 30--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">S</span>o, why write a static ﬁle when Ansible can do the work for you?
<a 
 id="x1-101001r152"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">9.1.2    </span> <a 
 id="x1-1020002"></a>Built-In Plugins</h4>
<!--l. 34--><p class="noindent" >Ansible includes plugins for many popular platforms: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 36--><p class="noindent" >AWS
      </p></li>
      <li class="itemize">
      <!--l. 37--><p class="noindent" >GCP
      </p></li>
      <li class="itemize">
      <!--l. 38--><p class="noindent" >Azure
      </p></li>
      <li class="itemize">
      <!--l. 39--><p class="noindent" >Kubernetes</p></li></ul>
<!--l. 42--><p class="noindent" >These plugins let you connect to your cloud provider and pull in your
infrastructure details dynamically. No more manual updates.
<a 
 id="x1-102001r151"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.2    </span> <a 
 id="x1-1030002"></a>Using AWS Dynamic Inventory</h3>
<!--l. 47--><p class="noindent" >If you’re running your infrastructure on AWS, the AWS dynamic inventory
plugin is a game-changer. Let’s set it up.
<a 
 id="x1-103001r153"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">9.2.1    </span> <a 
 id="x1-1040001"></a>Installing the Required Tools</h4>
<!--l. 51--><p class="noindent" >First, you’ll need the AWS CLI and the <span 
class="pcrr8t-x-x-120">boto3 </span>Python library: </p><!--l. 52-->
<a 
 id="x1-104001r1"></a>
<a 
 id="x1-104002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.1:
      </span><span  
class="content">Installing
      AWS
      Tools</span></div><!--tex4ht:label?: x1-104001r9 --><div class="lstlisting" id="listing-47"><span class="label"><a 
 id="x1-104003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">pip</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">boto3</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-104004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">pip</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">botocore</span></span></div>
  
<!--l. 57--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">C</span>onﬁgure the AWS CLI with your credentials: </p><!--l. 58-->
<a 
 id="x1-104005r2"></a>
<a 
 id="x1-104006"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.2:
      </span><span  
class="content">Conﬁguring
      AWS
      CLI</span></div><!--tex4ht:label?: x1-104005r9 --><div class="lstlisting" id="listing-48"><span class="label"><a 
 id="x1-104007r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">aws</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configure</span></span></div>
  
<a 
 id="x1-104008r155"></a>
<h4 class="subsectionHead"><span class="titlemark">9.2.2    </span> <a 
 id="x1-1050002"></a>Conﬁguring the Plugin</h4>
<!--l. 64--><p class="noindent" >Create a ﬁle called <span 
class="pcrr8t-x-x-120">aws_inventory.yml</span>: </p><!--l. 65-->
<a 
 id="x1-105001r3"></a>
<a 
 id="x1-105002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 9.3:
          </span><span  
class="content">AWS
          Inventory
          Plugin
                                                                
                                                                
          Conﬁguration</span></div><!--tex4ht:label?: x1-105001r9 --><div class="lstlisting" id="listing-49"><span class="label"><a 
 id="x1-105003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">plugin</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">aws_ec2</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">regions</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor42"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">us</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">east</span></span><span style="color:#000000"><span 
class="pcrr8t-">-1</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span style="color:#000000"><span 
class="pcrr8t-">filters</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tag</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-">Environment</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">production</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span style="color:#000000"><span 
class="pcrr8t-">keyed_groups</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor43"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">key</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">tags</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">Name</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-105010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">prefix</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">instance</span></span></div>
  
<!--l. 76--><p class="noindent" >Here’s what’s happening: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 78--><p class="noindent" ><span 
class="pcrr8t-x-x-120">plugin: aws_ec2 </span>tells Ansible to use the AWS plugin.
      </p></li>
      <li class="itemize">
      <!--l. 79--><p class="noindent" ><span 
class="pcrr8t-x-x-120">regions </span>speciﬁes which AWS regions to query.
      </p></li>
      <li class="itemize">
      <!--l. 80--><p class="noindent" ><span 
class="pcrr8t-x-x-120">filters  </span>limits    results    to    instances    with    the    tag
      <span 
class="pcrr8t-x-x-120">Environment: production</span>.
      </p></li>
      <li class="itemize">
      <!--l. 81--><p class="noindent" ><span 
class="pcrr8t-x-x-120">keyed_groups </span>creates groups based on the <span 
class="pcrr8t-x-x-120">Name </span>tag.</p></li></ul>
<a 
 id="x1-105011r158"></a>
<h4 class="subsectionHead"><span class="titlemark">9.2.3    </span> <a 
 id="x1-1060003"></a>Running a Playbook with Dynamic Inventory</h4>
<!--l. 86--><p class="noindent" >Use the <span 
class="pcrr8t-x-x-120">-i </span>ﬂag to specify the dynamic inventory ﬁle: </p><!--l. 87-->
<a 
 id="x1-106001r4"></a>
<a 
 id="x1-106002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.4:
      </span><span  
class="content">Running
                                                                
                                                                
      a
      Playbook
      with
      AWS
      Dynamic
      Inventory</span></div><!--tex4ht:label?: x1-106001r9 --><div class="lstlisting" id="listing-50"><span class="label"><a 
 id="x1-106003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">aws_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 91--><p class="noindent" >Ansible dynamically queries AWS for the latest inventory and runs your
playbook. No static ﬁles, no hassle.
<a 
 id="x1-106004r154"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.3    </span> <a 
 id="x1-1070003"></a>Using GCP Dynamic Inventory</h3>
<!--l. 96--><p class="noindent" >Running on Google Cloud Platform (GCP)? Ansible has you covered. The
process is similar to AWS, but let’s break it down.
<a 
 id="x1-107001r160"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">9.3.1    </span> <a 
 id="x1-1080001"></a>Installing the GCP SDK</h4>
<!--l. 100--><p class="noindent" >Install the GCP SDK and authenticate: </p><!--l. 101-->
<a 
 id="x1-108001r5"></a>
<a 
 id="x1-108002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.5:
      </span><span  
class="content">Installing
      GCP
      SDK</span></div><!--tex4ht:label?: x1-108001r9 --><div class="lstlisting" id="listing-51"><span class="label"><a 
 id="x1-108003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">apt</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">get</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">google</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">cloud</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">sdk</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-108004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">gcloud</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">auth</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">application</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">default</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">login</span></span></div>
  
<a 
 id="x1-108005r163"></a>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">9.3.2    </span> <a 
 id="x1-1090002"></a>Conﬁguring the Plugin</h4>
<!--l. 108--><p class="noindent" >Create a ﬁle called <span 
class="pcrr8t-x-x-120">gcp_inventory.yml</span>: </p><!--l. 109-->
<a 
 id="x1-109001r6"></a>
<a 
 id="x1-109002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 9.6:
          </span><span  
class="content">GCP
          Inventory
          Plugin
          Conﬁguration</span></div><!--tex4ht:label?: x1-109001r9 --><div class="lstlisting" id="listing-52"><span class="label"><a 
 id="x1-109003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">plugin</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">gcp_compute</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">projects</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor44"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">my</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">gcp</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">project</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span style="color:#000000"><span 
class="pcrr8t-">filters</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor45"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">status</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">RUNNING</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span style="color:#000000"><span 
class="pcrr8t-">keyed_groups</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor46"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">key</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">labels</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">env</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-109010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">prefix</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">env</span></span></div>
  
<!--l. 120--><p class="noindent" >This conﬁguration pulls running instances from your GCP project and
groups them by the <span 
class="pcrr8t-x-x-120">env </span>label.
<a 
 id="x1-109011r165"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">9.3.3    </span> <a 
 id="x1-1100003"></a>Running a Playbook with GCP Inventory</h4>
<!--l. 124--><p class="noindent" >Just like with AWS, use the <span 
class="pcrr8t-x-x-120">-i </span>ﬂag: </p><!--l. 125-->
<a 
 id="x1-110001r7"></a>
<a 
 id="x1-110002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.7:
      </span><span  
class="content">Running
      a
      Playbook
      with
      GCP
      Inventory</span></div><!--tex4ht:label?: x1-110001r9 --><div class="lstlisting" id="listing-53"><span class="label"><a 
 id="x1-110003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">gcp_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 129--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">A</span>gain, no static ﬁles. Ansible does all the heavy lifting.
                                                                
                                                                
<a 
 id="x1-110004r162"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.4    </span> <a 
 id="x1-1110004"></a>Creating a Custom Dynamic Inventory Script</h3>
<!--l. 134--><p class="noindent" >Sometimes, your environment doesn’t ﬁt neatly into a cloud provider
plugin. Maybe you’re using an on-premises solution or a custom
API. In these cases, you can write your own dynamic inventory
script.
<a 
 id="x1-111001r167"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">9.4.1    </span> <a 
 id="x1-1120001"></a>The Basics of a Custom Script</h4>
<!--l. 138--><p class="noindent" >A dynamic inventory script must: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 140--><p class="noindent" >Output JSON data with the inventory structure.
      </p></li>
      <li class="itemize">
      <!--l. 141--><p class="noindent" >Respond to <span 
class="pcrr8t-x-x-120">-list </span>to return all hosts.
      </p></li>
      <li class="itemize">
      <!--l. 142--><p class="noindent" >Respond to <span 
class="pcrr8t-x-x-120">-host </span>to return variables for a speciﬁc host.</p></li></ul>
<!--l. 145--><p class="noindent" >Here’s an example script in Python: </p><!--l. 146-->
<a 
 id="x1-112001r8"></a>
<a 
 id="x1-112002"></a>
                                                                
                                                                
  <br />
               <div class="caption" 
><span class="id">Listing 9.8:
               </span><span  
class="content">Custom
               Inventory
               Script</span></div><!--tex4ht:label?: x1-112001r9 --><div class="lstlisting" id="listing-54"><span class="label"><a 
 id="x1-112003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">#</span></span><span style="color:#000000"><span 
class="pcrr8t-">!/</span></span><span style="color:#000000"><span 
class="pcrr8t-">usr</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">bin</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">env</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">python</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">import</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">json</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span style="color:#000000"><span 
class="pcrr8t-">def</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">get_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">()</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">webservers</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.10</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">,</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.11</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">],</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">vars</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">http_port</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">80</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">},</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">_meta</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">hostvars</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.10</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">admin</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">},</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">192.168.1.11</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_user</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">admin</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112019r17"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">17</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112020r18"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">18</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112021r19"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">19</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">return</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112022r20"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">20</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112023r21"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">21</span></span><span style="color:#000000"><span 
class="pcrr8t-">if</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">__name__</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">==</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">__main__</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112024r22"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">22</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">import</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">sys</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112025r23"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">23</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">if</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">list</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">in</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">sys</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">argv</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112026r24"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">24</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">print</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">json</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">dumps</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">get_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">()</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112027r25"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">25</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">elif</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">host</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">in</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">sys</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">argv</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-112028r26"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">26</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">print</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">json</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">dumps</span></span><span style="color:#000000"><span 
class="pcrr8t-">({})</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span></div>
  
<a 
 id="x1-112029r170"></a>
<h4 class="subsectionHead"><span class="titlemark">9.4.2    </span> <a 
 id="x1-1130002"></a>Using the Custom Script</h4>
<!--l. 177--><p class="noindent" >Make the script executable: </p><!--l. 178-->
<a 
 id="x1-113001r9"></a>
<a 
 id="x1-113002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.9:
      </span><span  
class="content">Making
      the
      Script
      Executable</span></div><!--tex4ht:label?: x1-113001r9 --><div class="lstlisting" id="listing-55"><span class="label"><a 
 id="x1-113003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">chmod</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">+</span></span><span style="color:#000000"><span 
class="pcrr8t-">x</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">custom_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">py</span></span></div>
  
<!--l. 182--><p class="noindent" >Run your playbook with the script as the inventory source: </p><!--l. 183-->
<a 
 id="x1-113004r10"></a>
<a 
 id="x1-113005"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 9.10:
      </span><span  
class="content">Using
      a
      Custom
      Inventory
      Script</span></div><!--tex4ht:label?: x1-113004r9 --><div class="lstlisting" id="listing-56"><span class="label"><a 
 id="x1-113006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">custom_inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">py</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">deploy</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 187--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">L</span>ook at that–your custom inventory is now part of your Ansible
                                                                
                                                                
workﬂow.
<a 
 id="x1-113007r169"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.5    </span> <a 
 id="x1-1140005"></a>Why Dynamic Inventories Matter</h3>
<!--l. 192--><p class="noindent" >Dynamic inventories are all about <span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>ntelligence and scalability. They
adapt to your environment, save you time, and make managing large
infrastructures feel eﬀortless.
</p><!--l. 194--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">N</span>o matter where your servers are–cloud, on-prem, or somewhere in
between–dynamic inventories ensure your playbooks always know what’s
going on.
<a 
 id="x1-114001r175"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">9.6    </span> <a 
 id="x1-1150006"></a>Wrapping Up</h3>
<!--l. 199--><p class="noindent" >Dynamic inventories are one of Ansible’s most powerful features. They let
you scale without breaking a sweat, whether you’re running a handful of
servers or managing a <span 
class="ntx-Bold-tlf-t1-x-x-120">g</span>lobal ﬂeet.
</p><!--l. 203--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore securing your playbooks with Ansible</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">Vault. Ready to lock things down? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 10</span><br /><a 
 id="x1-11600010"></a>Secrets and Security</h2>
<!--l. 3--><p class="noindent" >In the world of automation, keeping secrets isn’t just about hiding your
lunch money. It’s about protecting sensitive information like passwords,
API keys, and certiﬁcates. If you’ve ever emailed a plaintext password
to a teammate and then felt that uneasy pang of “I shouldn’t have
done that,” you’re not alone. The good news? Ansible’s got your
back.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll explore: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 7--><p class="noindent" >How to manage secrets with Ansible Vault.
      </p></li>
      <li class="itemize">
      <!--l. 8--><p class="noindent" >Best practices for writing secure playbooks.
      </p></li>
      <li class="itemize">
      <!--l. 9--><p class="noindent" >Using encryption and limiting access to keep your automation
      airtight.</p></li></ul>
<!--l. 12--><p class="noindent" >By the end, you’ll have the tools to automate with conﬁdence, knowing your
secrets are safe.
<a 
 id="x1-116001r176"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">10.1    </span> <a 
 id="x1-1170001"></a>Managing Secrets with Ansible Vault</h3>
<!--l. 17--><p class="noindent" >Ansible Vault is like a digital safe. It encrypts sensitive data so only those
                                                                
                                                                
with the right key can unlock it. Whether you’re storing passwords, tokens,
or private keys, Vault ensures your secrets stay secret.
<a 
 id="x1-117001r172"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.1.1    </span> <a 
 id="x1-1180001"></a>Creating an Encrypted File</h4>
<!--l. 21--><p class="noindent" >Let’s say you need to store a database password. Instead of adding it to
your playbook (a big no-no), you can create a Vault-encrypted ﬁle:
</p><!--l. 22-->
<a 
 id="x1-118001r1"></a>
<a 
 id="x1-118002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.1:
      </span><span  
class="content">Creating
      a
      Vault
      File</span></div><!--tex4ht:label?: x1-118001r10 --><div class="lstlisting" id="listing-57"><span class="label"><a 
 id="x1-118003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">secrets</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 26--><p class="noindent" >You’ll be prompted to set a password. Once you do, Ansible opens a text
editor where you can add your secrets: </p><!--l. 27-->
<a 
 id="x1-118004r2"></a>
<a 
 id="x1-118005"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.2:
      </span><span  
class="content">Example
      Vault
      File</span></div><!--tex4ht:label?: x1-118004r10 --><div class="lstlisting" id="listing-58"><span class="label"><a 
 id="x1-118006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">db_password</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">mysupersecretpassword</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-118007r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">api_key</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">123456789</span></span><span style="color:#000000"><span 
class="pcrr8t-">abcdef</span></span></div>
  
<!--l. 32--><p class="noindent" >Save the ﬁle, and it’s encrypted. Simple, right?
<a 
 id="x1-118008r179"></a>
                                                                
                                                                
</p>
<h4 class="subsectionHead"><span class="titlemark">10.1.2    </span> <a 
 id="x1-1190002"></a>Viewing and Editing Vault Files</h4>
<!--l. 36--><p class="noindent" >Need to peek inside or make a change? Use these commands: </p><!--l. 37-->
<a 
 id="x1-119001r3"></a>
<a 
 id="x1-119002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.3:
      </span><span  
class="content">Viewing
      a
      Vault
      File</span></div><!--tex4ht:label?: x1-119001r10 --><div class="lstlisting" id="listing-59"><span class="label"><a 
 id="x1-119003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">view</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">secrets</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 40-->
<a 
 id="x1-119004r4"></a>
<a 
 id="x1-119005"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.4:
      </span><span  
class="content">Editing
      a
      Vault
      File</span></div><!--tex4ht:label?: x1-119004r10 --><div class="lstlisting" id="listing-60"><span class="label"><a 
 id="x1-119006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">edit</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">secrets</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 44--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">S</span>ee how easy that is? Your secrets are locked away, but you still have full
control.
<a 
 id="x1-119007r182"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.1.3    </span> <a 
 id="x1-1200003"></a>Using Vault Files in Playbooks</h4>
<!--l. 48--><p class="noindent" >To use a Vault ﬁle in a playbook, include it as a variable ﬁle: </p><!--l. 49-->
                                                                
                                                                
<a 
 id="x1-120001r5"></a>
<a 
 id="x1-120002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 10.5:
               </span><span  
class="content">Using
               a
               Vault
               File
               in
               a
               Playbook</span></div><!--tex4ht:label?: x1-120001r10 --><div class="lstlisting" id="listing-61"><span class="label"><a 
 id="x1-120003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dbservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">vars_files</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor47"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">secrets</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor48"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Print</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">the</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">debug</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-120010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">msg</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">The</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">db_password</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span></div>
  
<!--l. 60--><p class="noindent" >When you run the playbook, Ansible will prompt you for the Vault
password: </p><!--l. 61-->
<a 
 id="x1-120011r6"></a>
<a 
 id="x1-120012"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.6:
      </span><span  
class="content">Running
      a
      Playbook
      with
      Vault</span></div><!--tex4ht:label?: x1-120011r10 --><div class="lstlisting" id="listing-62"><span class="label"><a 
 id="x1-120013r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">ask</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">pass</span></span></div>
  
<!--l. 65--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">E</span>asy to use, hard to break. That’s the beauty of Vault.
<a 
 id="x1-120014r178"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">10.2    </span> <a 
 id="x1-1210002"></a>Writing Secure Playbooks</h3>
<!--l. 70--><p class="noindent" >Good security isn’t just about encrypting secrets. It’s about how you write
your playbooks and manage your environment.
                                                                
                                                                
<a 
 id="x1-121001r185"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.2.1    </span> <a 
 id="x1-1220001"></a>Avoid Hardcoding Sensitive Data</h4>
<!--l. 74--><p class="noindent" >Never hardcode sensitive data directly in your playbooks. This: </p><!--l. 75-->
<a 
 id="x1-122001r7"></a>
<a 
 id="x1-122002"></a>
  <br />
             <div class="caption" 
><span class="id">Listing 10.7:
             </span><span  
class="content">Don’t
             Do
             This</span></div><!--tex4ht:label?: x1-122001r10 --><div class="lstlisting" id="listing-63"><span class="label"><a 
 id="x1-122003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Configure</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-122004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">hosts</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">dbservers</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-122005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">tasks</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-122006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor49"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Set</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">database</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-122007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">command</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">mysql</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">u</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">root</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">p</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">mysupersecretpassword</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">e</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">SET</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">PASSWORD</span></span><span style="color:#000000"><span 
class="pcrr8t-">...’"</span></span></div>
  
<!--l. 83--><p class="noindent" >...is a security nightmare. Instead, store sensitive data in Vault or
environment variables.
<a 
 id="x1-122008r189"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.2.2    </span> <a 
 id="x1-1230002"></a>Limit Access with Scoping</h4>
<!--l. 87--><p class="noindent" >Limit the scope of sensitive variables. For example, if a password is only
needed for database tasks, deﬁne it in the <span 
class="pcrr8t-x-x-120">dbservers </span>group and not
globally.
<a 
 id="x1-123001r191"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.2.3    </span> <a 
 id="x1-1240003"></a>Use Role-Speciﬁc Variables</h4>
<!--l. 91--><p class="noindent" >Roles are great for isolating sensitive information. Keep variables local to
roles using the <span 
class="pcrr8t-x-x-120">vars/ </span>directory:
                                                                
                                                                
</p>
<pre class="verbatim" id="verbatim-3">
roles/
  database/
    vars/
      main.yml
</pre>
<!--l. 97--><p class="nopar" >
</p><!--l. 99--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">C</span>ontainment is key. By scoping variables to roles, you reduce the risk of
accidental exposure.
<a 
 id="x1-124001r192"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.2.4    </span> <a 
 id="x1-1250004"></a>Audit Your Playbooks Regularly</h4>
<!--l. 103--><p class="noindent" >It’s easy for secrets to sneak into your playbooks. Schedule regular audits to
review for hardcoded values, excessive permissions, or unused variables.
Think of it as spring cleaning for your automation.
<a 
 id="x1-125001r188"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">10.3    </span> <a 
 id="x1-1260003"></a>Using Encryption and Limiting Access</h3>
<!--l. 108--><p class="noindent" >Ansible Vault is great, but there are other tools and techniques to enhance
security. Here are a few tips:
<a 
 id="x1-126001r193"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">10.3.1    </span> <a 
 id="x1-1270001"></a>Encrypting Entire Playbooks</h4>
<!--l. 112--><p class="noindent" >If you have a particularly sensitive playbook, encrypt the whole thing:
</p><!--l. 113-->
<a 
 id="x1-127001r8"></a>
<a 
 id="x1-127002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.8:
      </span><span  
class="content">Encrypting
      a
      Playbook</span></div><!--tex4ht:label?: x1-127001r10 --><div class="lstlisting" id="listing-64"><span class="label"><a 
 id="x1-127003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">encrypt</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<!--l. 117--><p class="noindent" >To run it: </p><!--l. 118-->
<a 
 id="x1-127004r9"></a>
<a 
 id="x1-127005"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.9:
      </span><span  
class="content">Running
      an
      Encrypted
      Playbook</span></div><!--tex4ht:label?: x1-127004r10 --><div class="lstlisting" id="listing-65"><span class="label"><a 
 id="x1-127006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">ask</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">pass</span></span></div>
  
<!--l. 122--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">U</span>se this sparingly–encrypting variables is usually enough.
<a 
 id="x1-127007r195"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.3.2    </span> <a 
 id="x1-1280002"></a>Managing Vault Passwords Securely</h4>
<!--l. 126--><p class="noindent" >Sharing Vault passwords can be tricky. Instead of emailing them around
(please don’t), use a password manager or an Ansible Vault password ﬁle:
</p><!--l. 127-->
                                                                
                                                                
<a 
 id="x1-128001r10"></a>
<a 
 id="x1-128002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 10.10:
      </span><span  
class="content">Using
      a
      Password
      File</span></div><!--tex4ht:label?: x1-128001r10 --><div class="lstlisting" id="listing-66"><span class="label"><a 
 id="x1-128003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">password</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">vault_pass</span></span></div>
  
<!--l. 131--><p class="noindent" >Store the password ﬁle securely and exclude it from version control by
adding it to your <span 
class="pcrr8t-x-x-120">.gitignore</span>.
<a 
 id="x1-128004r198"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">10.3.3    </span> <a 
 id="x1-1290003"></a>Limiting SSH Access</h4>
<!--l. 135--><p class="noindent" >Limit who can connect to your servers by using SSH key authentication and
restricting access to speciﬁc IPs. In your playbook, you can manage SSH
settings with tasks like this: </p><!--l. 136-->
<a 
 id="x1-129001r11"></a>
<a 
 id="x1-129002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 10.11:
          </span><span  
class="content">Restricting
          SSH
          Access</span></div><!--tex4ht:label?: x1-129001r10 --><div class="lstlisting" id="listing-67"><span class="label"><a 
 id="x1-129003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restrict</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">SSH</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">to</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">specific</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">IPs</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">lineinfile</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">ssh</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">sshd_config</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">regexp</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’^</span></span><span style="color:#000000"><span 
class="pcrr8t-">AllowUsers</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">line</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">AllowUsers</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">admin@192</span></span><span style="color:#000000"><span 
class="pcrr8t-">.168.1.1’</span></span></div>
  
<!--l. 144--><p class="noindent" >Restart SSH to apply the changes: </p><!--l. 145-->
  <div class="lstlisting" id="listing-68"><span class="label"><a 
 id="x1-129008r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restart</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">SSH</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129009r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129010r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">sshd</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-129011r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">restarted</span></span></div>
  
<!--l. 152--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">R</span>estricting access at the SSH level is one of the simplest ways to protect
                                                                
                                                                
your servers.
<a 
 id="x1-129012r194"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">10.4    </span> <a 
 id="x1-1300004"></a>Why Security Matters</h3>
<!--l. 157--><p class="noindent" >Let’s face it: mistakes happen. A plaintext password in a playbook or an
unencrypted API key in Git could lead to downtime–or worse. By following
these security practices, you’re not just protecting data–you’re building trust
with your team and users.
</p><!--l. 159--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>f security feels overwhelming, remember: start small. Encrypt one ﬁle.
Audit one playbook. Build your skills and habits over time.
<a 
 id="x1-130001r202"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">10.5    </span> <a 
 id="x1-1310005"></a>Wrapping Up</h3>
<!--l. 164--><p class="noindent" >Secrets and security aren’t just side quests–they’re core to building
reliable automation workﬂows. Ansible Vault makes i<span 
class="ntx-Bold-tlf-t1-x-x-120">t </span>easy to encrypt
sensitive data, but the real magic happens when you combine it with
good practices: limiting access, avoiding hardcoding, and auditing
regularl<span 
class="ntx-Bold-tlf-t1-x-x-120">y</span>.
</p><!--l. 168--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore debugging and troubleshooting. Because</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">even the best playbooks don’t always work on the ﬁrst try. Ready to level up</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">your problem-solving? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 11</span><br /><a 
 id="x1-13200011"></a>Advanced Ansible Concepts to Explore</h2>
<!--l. 3--><p class="noindent" >As your Ansible skills grow, you’ll encounter challenges that demand more
advanced tools and techniques. These features aren’t just bells and
whistles-they’re designed to make your workﬂows more eﬃcient, your
playbooks more powerful, and your automation smarter.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll explore: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 7--><p class="noindent" >Using handlers to trigger event-driven tasks.
      </p></li>
      <li class="itemize">
      <!--l. 8--><p class="noindent" >Extending Ansible’s power with plugins.
      </p></li>
      <li class="itemize">
      <!--l. 9--><p class="noindent" >Fine-tuning your environment with <span 
class="pcrr8t-x-x-120">ansible.cfg</span>.
      </p></li>
      <li class="itemize">
      <!--l. 10--><p class="noindent" >Testing your roles with Molecule.
      </p></li>
      <li class="itemize">
      <!--l. 11--><p class="noindent" >Mastering loops for eﬃciency.</p></li></ul>
<!--l. 14--><p class="noindent" >By diving into these concepts, you’ll unlock new possibilities and push your
Ansible skills to the next level.
<a 
 id="x1-132001r203"></a>
                                                                
                                                                
</p>
<h3 class="sectionHead"><span class="titlemark">11.1    </span> <a 
 id="x1-1330001"></a>Handlers: Event-Driven Tasks</h3>
<!--l. 19--><p class="noindent" >Handlers are like automation’s version of a reset button-they run only when
needed, ensuring you don’t overdo your tasks.
<a 
 id="x1-133001r200"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">11.1.1    </span> <a 
 id="x1-1340001"></a>When to Use Handlers</h4>
<!--l. 23--><p class="noindent" >Let’s say you’re managing a web server. If you update its conﬁguration ﬁle,
you don’t want to restart the service unless something actually changes.
That’s where handlers come in. Here’s an example: </p><!--l. 24-->
<a 
 id="x1-134001r1"></a>
<a 
 id="x1-134002"></a>
  <br />
             <div class="caption" 
><span class="id">Listing 11.1:
             </span><span  
class="content">Using
             Handlers
             for
             Service
             Restarts</span></div><!--tex4ht:label?: x1-134001r11 --><div class="lstlisting" id="listing-69"><span class="label"><a 
 id="x1-134003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Update</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">notify</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restart</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Start</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134012r10"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">10</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">started</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134013r11"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">11</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134014r12"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">12</span></span><span style="color:#000000"><span 
class="pcrr8t-">handlers</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134015r13"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">13</span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor50"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Restart</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134016r14"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">14</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">service</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134017r15"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">15</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-134018r16"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">16</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">restarted</span></span></div>
  
<!--l. 43--><p class="noindent" >The handler <span 
class="ntx-Bold-tlf-t1-x-x-120">only runs </span>if the task that notiﬁes it makes changes. Simple,
smart, and eﬃcient.
<a 
 id="x1-134019r206"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">11.1.2    </span> <a 
 id="x1-1350002"></a>Best Practices for Handlers</h4>
      <ul class="itemize1">
                                                                
                                                                
      <li class="itemize">
      <!--l. 48--><p class="noindent" >Group related handlers logically (e.g., one handler per service).
      </p></li>
      <li class="itemize">
      <!--l. 49--><p class="noindent" >Use descriptive names to make debugging easier.
      </p></li>
      <li class="itemize">
      <!--l. 50--><p class="noindent" >Combine tasks to reduce redundant notiﬁcations.</p></li></ul>
<a 
 id="x1-135001r205"></a>
<h3 class="sectionHead"><span class="titlemark">11.2    </span> <a 
 id="x1-1360002"></a>Plugins: Extending Ansible’s Power</h3>
<!--l. 56--><p class="noindent" >Plugins are the hidden gems of Ansible. They extend its functionality,
allowing you to customize and adapt it to your needs.
<a 
 id="x1-136001r208"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">11.2.1    </span> <a 
 id="x1-1370001"></a>Types of Plugins</h4>
<!--l. 60--><p class="noindent" >Ansible has several types of plugins, each with a speciﬁc purpose:
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 62--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Action Plugins</span>: Add new task types.
      </p></li>
      <li class="itemize">
      <!--l. 63--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Filter Plugins</span>: Transform data within your playbooks.
                                                                
                                                                
      </p></li>
      <li class="itemize">
      <!--l. 64--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Lookup Plugins</span>: Fetch data from external sources.
      </p></li>
      <li class="itemize">
      <!--l. 65--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Callback Plugins</span>: Customize output and logging.</p></li></ul>
<a 
 id="x1-137001r210"></a>
<h4 class="subsectionHead"><span class="titlemark">11.2.2    </span> <a 
 id="x1-1380002"></a>Creating a Custom Filter Plugin</h4>
<!--l. 70--><p class="noindent" >Here’s a simple ﬁlter plugin that capitalizes a string: </p><!--l. 71-->
<a 
 id="x1-138001r2"></a>
<a 
 id="x1-138002"></a>
  <br />
               <div class="caption" 
><span class="id">Listing 11.2:
               </span><span  
class="content">Custom
               Filter
               Plugin
               Example</span></div><!--tex4ht:label?: x1-138001r11 --><div class="lstlisting" id="listing-70"><span class="label"><a 
 id="x1-138003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">#</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">filter_plugins</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">capitalize</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">py</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">def</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">capitalize</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">value</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">return</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">value</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">upper</span></span><span style="color:#000000"><span 
class="pcrr8t-">()</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">class</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">FilterModule</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">object</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">def</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">filters</span></span><span style="color:#000000"><span 
class="pcrr8t-">(</span></span><span style="color:#000000"><span 
class="pcrr8t-">self</span></span><span style="color:#000000"><span 
class="pcrr8t-">)</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">return</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">capitalize</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">capitalize</span></span><span style="color:#000000"><span 
class="pcrr8t-">}</span></span></div>
  
<!--l. 81--><p class="noindent" >In your playbook, use it like this: </p><!--l. 82-->
<a 
 id="x1-138010r3"></a>
<a 
 id="x1-138011"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 11.3:
          </span><span  
class="content">Using
          a
          Custom
          Filter</span></div><!--tex4ht:label?: x1-138010r11 --><div class="lstlisting" id="listing-71"><span class="label"><a 
 id="x1-138012r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">debug</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-138013r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">msg</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-">hello</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">world</span></span><span style="color:#000000"><span 
class="pcrr8t-">’</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span id="textcolor51"><span 
class="pcrr8t-">|</span></span></span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">capitalize</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span></div>
  
<!--l. 87--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Output</span>: <span 
class="pcrr8t-x-x-120">HELLO WORLD</span>
                                                                
                                                                
<a 
 id="x1-138014r209"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">11.3    </span> <a 
 id="x1-1390003"></a>ansible.cfg: Fine-Tuning Your Environment</h3>
<!--l. 93--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">ansible.cfg </span>ﬁle is the command center for your Ansible
environment. It controls everything from logging to connection
settings.
<a 
 id="x1-139001r211"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">11.3.1    </span> <a 
 id="x1-1400001"></a>Common Settings</h4>
<!--l. 97--><p class="noindent" >Here’s a snippet of a typical <span 
class="pcrr8t-x-x-120">ansible.cfg</span>: </p><!--l. 98-->
<a 
 id="x1-140001r4"></a>
<a 
 id="x1-140002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 11.4:
      </span><span  
class="content">Sample
      ansible.cfg
      File</span></div><!--tex4ht:label?: x1-140001r11 --><div class="lstlisting" id="listing-72"><span class="label"><a 
 id="x1-140003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">defaults</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">./</span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span style="color:#000000"><span 
class="pcrr8t-">remote_user</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span style="color:#000000"><span 
class="pcrr8t-">log_path</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">./</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">log</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span style="color:#000000"><span 
class="pcrr8t-">retry_files_enabled</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrb8t-">False</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">privilege_escalation</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span style="color:#000000"><span 
class="pcrr8t-">become</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrb8t-">True</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-140011r9"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">9</span></span><span style="color:#000000"><span 
class="pcrr8t-">become_method</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">=</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">sudo</span></span></div>
  
<!--l. 110--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Key Options:</span> </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 112--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Inventory</span>: Path to your inventory ﬁle.
      </p></li>
      <li class="itemize">
      <!--l. 113--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Log Path</span>: Enables detailed logging for troubleshooting.
                                                                
                                                                
      </p></li>
      <li class="itemize">
      <!--l. 114--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Privilege Escalation</span>: Conﬁgures <span 
class="pcrr8t-x-x-120">sudo </span>or <span 
class="pcrr8t-x-x-120">become </span>behavior.</p></li></ul>
<a 
 id="x1-140012r215"></a>
<h4 class="subsectionHead"><span class="titlemark">11.3.2    </span> <a 
 id="x1-1410002"></a>Tips for Optimizing ansible.cfg</h4>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 120--><p class="noindent" >Use comments to document settings for team members.
      </p></li>
      <li class="itemize">
      <!--l. 121--><p class="noindent" >Keep   separate   <span 
class="pcrr8t-x-x-120">ansible.cfg </span>ﬁles   for   development   and
      production environments.
      </p></li>
      <li class="itemize">
      <!--l. 122--><p class="noindent" >Test  changes  in  a  sandbox  environment  to  avoid  unexpected
      issues.</p></li></ul>
<a 
 id="x1-141001r214"></a>
<h3 class="sectionHead"><span class="titlemark">11.4    </span> <a 
 id="x1-1420004"></a>Molecule: Testing Your Roles</h3>
<!--l. 128--><p class="noindent" >Molecule ensures your playbooks and roles work reliably by providing a
controlled environment for testing.
<a 
 id="x1-142001r217"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">11.4.1    </span> <a 
 id="x1-1430001"></a>Setting Up Molecule</h4>
<!--l. 132--><p class="noindent" >Install Molecule and the necessary dependencies: </p><!--l. 133-->
<a 
 id="x1-143001r5"></a>
<a 
 id="x1-143002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 11.5:
      </span><span  
class="content">Installing
      Molecule</span></div><!--tex4ht:label?: x1-143001r11 --><div class="lstlisting" id="listing-73"><span class="label"><a 
 id="x1-143003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">pip</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">molecule</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-143004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span style="color:#000000"><span 
class="pcrr8t-">pip</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">docker</span></span></div>
  
<!--l. 138--><p class="noindent" >Initialize a new role with Molecule: </p><!--l. 139-->
<a 
 id="x1-143005r6"></a>
<a 
 id="x1-143006"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 11.6:
      </span><span  
class="content">Initializing
      a
      Role
      for
      Molecule</span></div><!--tex4ht:label?: x1-143005r11 --><div class="lstlisting" id="listing-74"><span class="label"><a 
 id="x1-143007r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">molecule</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">init</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">role</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">my_role</span></span></div>
  
<a 
 id="x1-143008r219"></a>
<h4 class="subsectionHead"><span class="titlemark">11.4.2    </span> <a 
 id="x1-1440002"></a>Running Tests</h4>
<!--l. 145--><p class="noindent" >Run tests with the following command: </p><!--l. 146-->
<a 
 id="x1-144001r7"></a>
<a 
 id="x1-144002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 11.7:
      </span><span  
class="content">Running
      Molecule
                                                                
                                                                
      Tests</span></div><!--tex4ht:label?: x1-144001r11 --><div class="lstlisting" id="listing-75"><span class="label"><a 
 id="x1-144003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">molecule</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">test</span></span></div>
  
<!--l. 150--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Output</span>: Molecule will create a temporary environment, apply your
playbook, and verify the results.
<a 
 id="x1-144004r218"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">11.5    </span> <a 
 id="x1-1450005"></a>Mastering Loops</h3>
<!--l. 155--><p class="noindent" >Loops in Ansible make repetitive tasks eﬃcient and elegant.
<a 
 id="x1-145001r222"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">11.5.1    </span> <a 
 id="x1-1460001"></a>Using Simple Loops</h4>
<!--l. 159--><p class="noindent" >Here’s an example of a basic loop: </p><!--l. 160-->
<a 
 id="x1-146001r8"></a>
<a 
 id="x1-146002"></a>
  <br />
         <div class="caption" 
><span class="id">Listing 11.8:
         </span><span  
class="content">Installing
         Multiple
         Packages
         with
         Loops</span></div><!--tex4ht:label?: x1-146001r11 --><div class="lstlisting" id="listing-76"><span class="label"><a 
 id="x1-146003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">common</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">item</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">loop</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor52"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">vim</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor53"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">curl</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-146010r8"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">8</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor54"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">git</span></span></div>
  
<a 
 id="x1-146011r225"></a>
<h4 class="subsectionHead"><span class="titlemark">11.5.2    </span> <a 
 id="x1-1470002"></a>Advanced Loops</h4>
<!--l. 173--><p class="noindent" >With nested loops, you can handle more complex scenarios: </p><!--l. 174-->
                                                                
                                                                
<a 
 id="x1-147001r9"></a>
<a 
 id="x1-147002"></a>
  <br />
         <div class="caption" 
><span class="id">Listing 11.9:
         </span><span  
class="content">Nested
         Loops
         Example</span></div><!--tex4ht:label?: x1-147001r11 --><div class="lstlisting" id="listing-77"><span class="label"><a 
 id="x1-147003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Create</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directories</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">path</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"/</span></span><span style="color:#000000"><span 
class="pcrr8t-">var</span></span><span style="color:#000000"><span 
class="pcrr8t-">/{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">item</span></span><span style="color:#000000"><span 
class="pcrr8t-">.0</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}/{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">item</span></span><span style="color:#000000"><span 
class="pcrr8t-">.1</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">directory</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147007r5"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">5</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">with_nested</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147008r6"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">6</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor55"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">app1</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">,</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">app2</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-147009r7"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">7</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span id="textcolor56"><span 
class="pcrr8t-"> -</span><span 
class="pcrr8t-"> </span></span></span><span style="color:#000000"><span 
class="pcrr8t-">[</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">logs</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">,</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">configs</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">]</span></span></div>
  
<!--l. 184--><p class="noindent" >This creates directories like: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 186--><p class="noindent" ><span 
class="pcrr8t-x-x-120">/var/app1/logs</span>
      </p></li>
      <li class="itemize">
      <!--l. 187--><p class="noindent" ><span 
class="pcrr8t-x-x-120">/var/app1/configs</span>
      </p></li>
      <li class="itemize">
      <!--l. 188--><p class="noindent" ><span 
class="pcrr8t-x-x-120">/var/app2/logs</span>
      </p></li>
      <li class="itemize">
      <!--l. 189--><p class="noindent" ><span 
class="pcrr8t-x-x-120">/var/app2/configs</span></p></li></ul>
<a 
 id="x1-147010r224"></a>
<h3 class="sectionHead"><span class="titlemark">11.6    </span> <a 
 id="x1-1480006"></a>Wrapping Up</h3>
<!--l. 195--><p class="noindent" >These advanced Ansible features-handlers, plugins, conﬁgurations,
Molecule, and loops-are powerful tools for scaling and reﬁning
                                                                
                                                                
your automation. Each one adds ﬂexibility and precision to your
workﬂows, empowering you to tackle more complex challenges with
conﬁdence.
</p><!--l. 197--><p class="noindent" >As you integrate these techniques into your practice, remember to keep the
principles of simplicity and balance at the forefront.
</p><!--l. 201--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">Your Ansible journey doesn’t end here. Continue to explore, experiment,</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">and grow. Automation is a skill, and mastery is just around the corner.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 12</span><br /><a 
 id="x1-14900012"></a>Debugging and Troubleshooting</h2>
<!--l. 3--><p class="noindent" >Even the best playbooks don’t work perfectly on the ﬁrst try. Maybe you
misspell a module name, reference the wrong variable, or forget to install a
dependency. It happens to everyone. Debugging isn’t a failure–it’s part of
the process.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll explore: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 7--><p class="noindent" >Common issues and how to ﬁx them.
      </p></li>
      <li class="itemize">
      <!--l. 8--><p class="noindent" >Using <span 
class="pcrr8t-x-x-120">ansible-playbook </span>with debug options.
      </p></li>
      <li class="itemize">
      <!--l. 9--><p class="noindent" >Testing changes safely, so you don’t break production.</p></li></ul>
<!--l. 12--><p class="noindent" >By the end, you’ll have the tools to debug with conﬁdence and turn
problems into learning opportunities.
<a 
 id="x1-149001r229"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">12.1    </span> <a 
 id="x1-1500001"></a>Common Issues and How to Fix Them</h3>
<!--l. 17--><p class="noindent" >Let’s start with some common Ansible issues. If you’ve spent any
time writing playbooks, you’ve probably encountered a few of these
already.
                                                                
                                                                
<a 
 id="x1-150001r227"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.1.1    </span> <a 
 id="x1-1510001"></a>Syntax Errors</h4>
<!--l. 21--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">D</span>id you forget a colon or indent something incorrectly? YAML is picky
about formatting, and a single mistake can cause your playbook to
fail.
</p><!--l. 23--><p class="noindent" >Here’s an example of bad YAML: </p><!--l. 24-->
<a 
 id="x1-151001r1"></a>
<a 
 id="x1-151002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 12.1:
          </span><span  
class="content">Bad
          YAML</span></div><!--tex4ht:label?: x1-151001r12 --><div class="lstlisting" id="listing-78"><span class="label"><a 
 id="x1-151003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 31--><p class="noindent" >What’s wrong? The <span 
class="pcrr8t-x-x-120">package </span>module is missing a colon. Fix it like this:
</p><!--l. 32-->
<a 
 id="x1-151007r2"></a>
<a 
 id="x1-151008"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 12.2:
          </span><span  
class="content">Correct
          YAML</span></div><!--tex4ht:label?: x1-151007r12 --><div class="lstlisting" id="listing-79"><span class="label"><a 
 id="x1-151009r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151010r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151011r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-151012r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<!--l. 39--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">Tip</span>: Use a YAML linter like <span 
class="pcrr8t-x-x-120">yamllint </span>to catch these issues early:
</p><!--l. 40-->
<a 
 id="x1-151013r3"></a>
<a 
 id="x1-151014"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 12.3:
                                                                
                                                                
      </span><span  
class="content">Using
      yamllint</span></div><!--tex4ht:label?: x1-151013r12 --><div class="lstlisting" id="listing-80"><span class="label"><a 
 id="x1-151015r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">yamllint</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span></div>
  
<a 
 id="x1-151016r232"></a>
<h4 class="subsectionHead"><span class="titlemark">12.1.2    </span> <a 
 id="x1-1520002"></a>Module Not Found</h4>
<!--l. 46--><p class="noindent" >If Ansible can’t ﬁnd a module, it’s often because the module isn’t installed
or the name is misspelled. Double-check the module name in the Ansible
documentation.
</p><!--l. 48--><p class="noindent" >For example, <span 
class="pcrr8t-x-x-120">apt </span>works for Debian-based systems, but if you’re on
CentOS, you need <span 
class="pcrr8t-x-x-120">dnf </span>or <span 
class="pcrr8t-x-x-120">yum</span>: </p><!--l. 49-->
<a 
 id="x1-152001r4"></a>
<a 
 id="x1-152002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 12.4:
          </span><span  
class="content">Correct
          Module
          for
          CentOS</span></div><!--tex4ht:label?: x1-152001r12 --><div class="lstlisting" id="listing-81"><span class="label"><a 
 id="x1-152003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Install</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">packages</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-152004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">package</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-152005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">httpd</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-152006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">state</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">present</span></span></div>
  
<a 
 id="x1-152007r236"></a>
<h4 class="subsectionHead"><span class="titlemark">12.1.3    </span> <a 
 id="x1-1530003"></a>Connection Issues</h4>
<!--l. 58--><p class="noindent" >Sometimes Ansible can’t connect to a host. Here’s how to debug it:
</p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 60--><p class="noindent" >Check your SSH conﬁguration. Is the user and key correct?
                                                                
                                                                
      </p></li>
      <li class="itemize">
      <!--l. 61--><p class="noindent" >Use <span 
class="pcrr8t-x-x-120">ping </span>to test connectivity: </p><!--l. 62-->
<a 
 id="x1-153001r5"></a>
<a 
 id="x1-153002"></a>
        <br />
           <div class="caption" 
><span class="id">Listing 12.5:
           </span><span  
class="content">Testing
           Connectivity</span></div><!--tex4ht:label?: x1-153001r12 --><div class="lstlisting" id="listing-82"><span class="label"><a 
 id="x1-153003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">ping</span></span></div>
        
      </li>
      <li class="itemize">
      <!--l. 65--><p class="noindent" >If the connection fails, add <span 
class="pcrr8t-x-x-120">-vvv </span>for more detail: </p><!--l. 66-->
<a 
 id="x1-153004r6"></a>
<a 
 id="x1-153005"></a>
        <br />
           <div class="caption" 
><span class="id">Listing 12.6:
           </span><span  
class="content">Verbose
           Output</span></div><!--tex4ht:label?: x1-153004r12 --><div class="lstlisting" id="listing-83"><span class="label"><a 
 id="x1-153006r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">all</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">m</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">ping</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vvv</span></span></div>
        
      </li></ul>
<!--l. 71--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">E</span>rrors like “permission denied” often mean your SSH key isn’t set up
properly. Fix that ﬁrst.
<a 
 id="x1-153007r231"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">12.2    </span> <a 
 id="x1-1540002"></a>Using Ansible-Playbook with Debug Options</h3>
<!--l. 76--><p class="noindent" >When things don’t work as expected, debugging options can save the day.
                                                                
                                                                
Ansible provides several tools to help you ﬁgure out what’s going
wrong.
<a 
 id="x1-154001r238"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.2.1    </span> <a 
 id="x1-1550001"></a>Verbose Mode</h4>
<!--l. 80--><p class="noindent" >Verbose mode is your best friend when debugging. Add one or more <span 
class="pcrr8t-x-x-120">-v</span>
ﬂags to your <span 
class="pcrr8t-x-x-120">ansible-playbook </span>command: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 82--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-v</span>: Basic details.
      </p></li>
      <li class="itemize">
      <!--l. 83--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-vv</span>: More details.
      </p></li>
      <li class="itemize">
      <!--l. 84--><p class="noindent" ><span 
class="pcrr8t-x-x-120">-vvv</span>: Full debug output.</p></li></ul>
<!--l. 87--><p class="noindent" >Here’s an example: </p><!--l. 88-->
<a 
 id="x1-155001r7"></a>
<a 
 id="x1-155002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 12.7:
      </span><span  
class="content">Running
      a
      Playbook
      with
      Verbose
      Output</span></div><!--tex4ht:label?: x1-155001r12 --><div class="lstlisting" id="listing-84"><span class="label"><a 
 id="x1-155003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">vvv</span></span></div>
  
                                                                
                                                                
<!--l. 92--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">B</span>race yourself for a wall of text, but buried in there is the clue you need to
ﬁx your issue.
<a 
 id="x1-155004r242"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.2.2    </span> <a 
 id="x1-1560002"></a>Debug Module</h4>
<!--l. 96--><p class="noindent" >The <span 
class="pcrr8t-x-x-120">debug </span>module is a simple but powerful tool for troubleshooting. Use
it to print variable values or conﬁrm tasks are working as expected:
</p><!--l. 97-->
<a 
 id="x1-156001r8"></a>
<a 
 id="x1-156002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 12.8:
          </span><span  
class="content">Using
          the
          Debug
          Module</span></div><!--tex4ht:label?: x1-156001r12 --><div class="lstlisting" id="listing-85"><span class="label"><a 
 id="x1-156003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Print</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">variable</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">value</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-156004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">debug</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-156005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">msg</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">The</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">is</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">{{</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible_hostname</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">}}"</span></span></div>
  
<!--l. 103--><p class="noindent" >This prints the value of <span 
class="pcrr8t-x-x-120">ansible_hostname </span>to your console.
<a 
 id="x1-156006r244"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.2.3    </span> <a 
 id="x1-1570003"></a>Check Mode</h4>
<!--l. 107--><p class="noindent" >Check mode (<span 
class="pcrr8t-x-x-120">-check</span>) is like a rehearsal for your playbook. It
tells you what will change without actually making any changes:
</p><!--l. 108-->
<a 
 id="x1-157001r9"></a>
<a 
 id="x1-157002"></a>
                                                                
                                                                
  <br />
      <div class="caption" 
><span class="id">Listing 12.9:
      </span><span  
class="content">Running
      a
      Playbook
      in
      Check
      Mode</span></div><!--tex4ht:label?: x1-157001r12 --><div class="lstlisting" id="listing-86"><span class="label"><a 
 id="x1-157003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">check</span></span></div>
  
<!--l. 112--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">U</span>se this to test changes safely, especially in production environments.
<a 
 id="x1-157004r246"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.2.4    </span> <a 
 id="x1-1580004"></a>Step Mode</h4>
<!--l. 116--><p class="noindent" >Step mode (<span 
class="pcrr8t-x-x-120">-step</span>) pauses after each task, letting you decide whether to
continue: </p><!--l. 117-->
<a 
 id="x1-158001r10"></a>
<a 
 id="x1-158002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 12.10:
      </span><span  
class="content">Running
      a
      Playbook
      in
      Step
      Mode</span></div><!--tex4ht:label?: x1-158001r12 --><div class="lstlisting" id="listing-87"><span class="label"><a 
 id="x1-158003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">step</span></span></div>
  
<!--l. 121--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">G</span>reat for understanding the ﬂow of a playbook and catching issues
early.
<a 
 id="x1-158004r241"></a>
</p>
                                                                
                                                                
<h3 class="sectionHead"><span class="titlemark">12.3    </span> <a 
 id="x1-1590003"></a>Testing Changes Safely</h3>
<!--l. 126--><p class="noindent" >Testin<span 
class="ntx-Bold-tlf-t1-x-x-120">g </span>is crucial, especially when dealing with production systems. Here’s
how to test changes without risking downtime.
<a 
 id="x1-159001r248"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.3.1    </span> <a 
 id="x1-1600001"></a>Use a Staging Environment</h4>
<!--l. 130--><p class="noindent" >Always test your playbooks in a staging environment before running them
in production. Staging should mirror production as closely as possible,
including: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 132--><p class="noindent" >Same operating system and version.
      </p></li>
      <li class="itemize">
      <!--l. 133--><p class="noindent" >Similar hardware or virtual machine specs.
      </p></li>
      <li class="itemize">
      <!--l. 134--><p class="noindent" >Identical conﬁgurations (minus sensitive data).</p></li></ul>
<!--l. 137--><p class="noindent" >Don’t have a staging environment? Set one up. <span 
class="ntx-Bold-tlf-t1-x-x-120">I</span>t’s worth the eﬀort.
<a 
 id="x1-160001r251"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">12.3.2    </span> <a 
 id="x1-1610002"></a>Target Speciﬁc Hosts</h4>
<!--l. 141--><p class="noindent" >When testing changes, target a single host or a small group instead of
running the playbook on all hosts: </p><!--l. 142-->
                                                                
                                                                
<a 
 id="x1-161001r11"></a>
<a 
 id="x1-161002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 12.11:
      </span><span  
class="content">Running
      on
      a
      Single
      Host</span></div><!--tex4ht:label?: x1-161001r12 --><div class="lstlisting" id="listing-88"><span class="label"><a 
 id="x1-161003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">limit</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span><span style="color:#000000"><span 
class="pcrr8t-">host1</span></span><span style="color:#000000"><span 
class="pcrr8t-">"</span></span></div>
  
<a 
 id="x1-161004r252"></a>
<h4 class="subsectionHead"><span class="titlemark">12.3.3    </span> <a 
 id="x1-1620003"></a>Use Check Mode and Diﬀ Mode</h4>
<!--l. 148--><p class="noindent" >Combine <span 
class="pcrr8t-x-x-120">-check </span>and <span 
class="pcrr8t-x-x-120">-diff </span>to see what changes will be made and how
ﬁles will be modiﬁed: </p><!--l. 149-->
<a 
 id="x1-162001r12"></a>
<a 
 id="x1-162002"></a>
  <br />
      <div class="caption" 
><span class="id">Listing 12.12:
      </span><span  
class="content">Using
      Check
      and
      Diﬀ
      Modes</span></div><!--tex4ht:label?: x1-162001r12 --><div class="lstlisting" id="listing-89"><span class="label"><a 
 id="x1-162003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-">i</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">inventory</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">playbook</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">yml</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">check</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">--</span></span><span style="color:#000000"><span 
class="pcrr8t-">diff</span></span></div>
  
<!--l. 153--><p class="noindent" >This is especially useful for tasks that modify conﬁguratio<span 
class="ntx-Bold-tlf-t1-x-x-120">n </span>ﬁles.
<a 
 id="x1-162004r254"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">12.3.4    </span> <a 
 id="x1-1630004"></a>Back Up Before Making Changes</h4>
<!--l. 157--><p class="noindent" >Always back up important ﬁles before running a playbook. You can
automate this with Ansible: </p><!--l. 158-->
<a 
 id="x1-163001r13"></a>
<a 
 id="x1-163002"></a>
  <br />
          <div class="caption" 
><span class="id">Listing 12.13:
          </span><span  
class="content">Backing
          Up
          a
          File</span></div><!--tex4ht:label?: x1-163001r12 --><div class="lstlisting" id="listing-90"><span class="label"><a 
 id="x1-163003r1"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">1</span></span><span style="color:#000000"><span 
class="pcrr8t-">-</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">name</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">Back</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">up</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">configuration</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">file</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-163004r2"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">2</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">ansible</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">builtin</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">copy</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-163005r3"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">3</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">src</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span 
class="pcrr8t-"> </span><br /> 
<span class="label"><a 
 id="x1-163006r4"></a><span 
class="ntx-Regular-tlf-t1-x-x-60">4</span></span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span 
class="pcrr8t-"> </span><span style="color:#000000"><span 
class="pcrr8t-">dest</span></span><span style="color:#000000"><span 
class="pcrr8t-">:</span></span><span style="color:#000000"><span 
class="pcrr8t-"> </span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">etc</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">/</span></span><span style="color:#000000"><span 
class="pcrr8t-">nginx</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">conf</span></span><span style="color:#000000"><span 
class="pcrr8t-">.</span></span><span style="color:#000000"><span 
class="pcrr8t-">bak</span></span></div>
  
<a 
 id="x1-163007r250"></a>
<h3 class="sectionHead"><span class="titlemark">12.4    </span> <a 
 id="x1-1640004"></a>Why Debugging Matters</h3>
<!--l. 168--><p class="noindent" >Debugging isn’t just about ﬁxing mistakes–it’s about learning. Every error
is an opportunity to understand your systems better and improve your
playbooks. The more you debug, the better you’ll get at anticipating and
preventing issues.
</p><!--l. 170--><p class="noindent" ><span 
class="ntx-Bold-tlf-t1-x-x-120">G</span>o easy on yourself. Debugging takes time, but it’s worth it.
<a 
 id="x1-164001r258"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">12.5    </span> <a 
 id="x1-1650005"></a>Wrapping Up</h3>
<!--l. 175--><p class="noindent" >Debugging and troubleshooting are part of every automation journey. With
Ansible’s tools–verbose mode, the debug module, and check mode–you can
tackle issues head-on. Testing changes safely ensures you don’t accidentally
bring down production while ﬁxing a bug.
                                                                
                                                                
</p><!--l. 179--><p class="noindent" ><span 
class="ntx-Italic-tlf-t1-x-x-120">In the next chapter, we’ll explore writing reusable, scalable roles. Ready to</span>
<span 
class="ntx-Italic-tlf-t1-x-x-120">level up your playbooks? Let’s go.</span>
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="chapterHead"><span class="titlemark">Chapter 13</span><br /><a 
 id="x1-16600013"></a>Reﬂections and Next Steps</h2>
<!--l. 3--><p class="noindent" >As we reach the end of this journey, it’s time to pause and reﬂect.
Automation isn’t just about saving time or reducing manual eﬀort–it’s about
creating space. Space for creativity, problem-solving, and growth. When
done right, automation simpliﬁes the complex and brings clarity to
chaos.
</p><!--l. 5--><p class="noindent" >In this chapter, we’ll look back on what we’ve learned and discuss the
art of balance in IT automation. For further resources to continue
your Ansible journey, see the bibliography section at the end of this
book.
<a 
 id="x1-166001r259"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">13.1    </span> <a 
 id="x1-1670001"></a>Reﬂecting on Simplicity and Automation</h3>
<!--l. 11--><p class="noindent" >Ansible isn’t just a tool; it’s a philosophy. At its core, Ansible embraces
simplicity. It doesn’t try to be ﬂashy or overly complex. Instead, it focuses
on doing one thing really well: making automation accessible.
<a 
 id="x1-167001r256"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.1.1    </span> <a 
 id="x1-1680001"></a>The Power of Simplicity</h4>
<!--l. 15--><p class="noindent" >Think about your ﬁrst playbook. Maybe it was a single task to install a
package or set up a directory. It wasn’t much, but it worked. That’s the
beauty of Ansible: you don’t need to be an expert to get started.
</p><!--l. 17--><p class="noindent" >Now, look at where you are. You’ve built workﬂows, managed secrets, and
debugged like a pro. Step by step, you’ve turned simple tasks into
                                                                
                                                                
powerful automation. That’s the power of simplicity–it builds on
itself.
</p><!--l. 19--><p class="noindent" >But simplicity isn’t just about doing less. It’s about doing what matters.
Ansible helps you focus on outcomes, not processes. It removes the noise,
so you can concentrate on what’s important.
<a 
 id="x1-168001r262"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.1.2    </span> <a 
 id="x1-1690002"></a>Learning Through Action</h4>
<!--l. 23--><p class="noindent" >Every error you debugged, every playbook you wrote, and every task you
ran taught you something. Automation isn’t a destination; it’s a journey.
And the more you automate, the more you learn about your systems, your
workﬂows, and yourself.
</p><!--l. 25--><p class="noindent" >As you reﬂect, remember: it’s okay to make mistakes. They’re part of the
process. The key is to learn from them and keep moving forward.
<a 
 id="x1-169001r261"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">13.2    </span> <a 
 id="x1-1700002"></a>The Art of Balance in IT Automation</h3>
<!--l. 30--><p class="noindent" >Automation is a powerful tool, but like any tool, it’s most eﬀective when
used with intention. The art of automation isn’t about automating
everything–it’s about ﬁnding the right balance.
<a 
 id="x1-170001r263"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.2.1    </span> <a 
 id="x1-1710001"></a>When to Automate</h4>
<!--l. 34--><p class="noindent" >Not every task needs to be automated. Some things are better left manual,
especially if they’re: </p>
                                                                
                                                                
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 36--><p class="noindent" >Rarely performed (e.g., one-time setup tasks).
      </p></li>
      <li class="itemize">
      <!--l. 37--><p class="noindent" >Complex and diﬃcult to script.
      </p></li>
      <li class="itemize">
      <!--l. 38--><p class="noindent" >More eﬃcient to handle interactively.</p></li></ul>
<!--l. 41--><p class="noindent" >Ask yourself: “Does automating this save time, reduce errors, or improve
consistency?” If the answer is yes, it’s worth considering.
<a 
 id="x1-171001r265"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.2.2    </span> <a 
 id="x1-1720002"></a>When Not to Automate</h4>
<!--l. 45--><p class="noindent" >Over-automation can create its own problems. Playbooks can become
brittle, hard to maintain, or overly complex. The goal isn’t to automate for
the sake of it–it’s to make your workﬂows better.
</p><!--l. 47--><p class="noindent" >Here’s a good rule of thumb: If a playbook takes longer to write than the
time it saves, it might not be worth it.
<a 
 id="x1-172001r266"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.2.3    </span> <a 
 id="x1-1730003"></a>Iterate and Improve</h4>
<!--l. 51--><p class="noindent" >Automation is never “done.” Systems evolve, requirements change, and
your playbooks need to keep up. Regularly review your automation for:
</p>
                                                                
                                                                
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 53--><p class="noindent" >Opportunities to simplify or streamline tasks.
      </p></li>
      <li class="itemize">
      <!--l. 54--><p class="noindent" >Outdated assumptions or conﬁgurations.
      </p></li>
      <li class="itemize">
      <!--l. 55--><p class="noindent" >New features or modules that can improve eﬃciency.</p></li></ul>
<!--l. 58--><p class="noindent" >Never stop iterating. Small improvements add up over time.
<a 
 id="x1-173001r264"></a>
</p>
<h3 class="sectionHead"><span class="titlemark">13.3    </span> <a 
 id="x1-1740003"></a>Why Balance Matters</h3>
<!--l. 63--><p class="noindent" >In automation–and in life–balance is everything. Too little automation, and
you’re stuck doing repetitive tasks. Too much, and you risk losing control of
your workﬂows. The sweet spot is where automation works for you, not the
other way around.
<a 
 id="x1-174001r267"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">13.3.1    </span> <a 
 id="x1-1750001"></a>The Human Element</h4>
<!--l. 67--><p class="noindent" >Remember: automation is a tool, not a replacement for human judgment.
Your expertise, creativity, and intuition are irreplaceable. Use automation to
handle the grunt work so you can focus on higher-value tasks.
<a 
 id="x1-175001r269"></a>
</p>
                                                                
                                                                
<h4 class="subsectionHead"><span class="titlemark">13.3.2    </span> <a 
 id="x1-1760002"></a>The Long Game</h4>
<!--l. 71--><p class="noindent" >Automation is a marathon, not a sprint. Build your workﬂows gradually. Focus
on solving real problems, and don’t get bogged down in perfectionism.
Progress is more important than perfection.
</p><!--l. 73--><p class="noindent" >Celebrate your wins–big and small. Every playbook you write, every task
you automate, and every error you debug is a step forward.
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
                                                                
</p>
<h2 class="likechapterHead"><a 
 id="x1-1770002"></a>Bibliography</h2>
     <div class="thebibliography">
     <p class="bibitem" ><span class="biblabel">
  [1]<span class="bibsp">   </span></span><a 
 id="XgettingStartedDigitalOcean"></a>DigitalOcean. Getting started with ansible. 2023.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [2]<span class="bibsp">   </span></span><a 
 id="XansibleForDevOps"></a>Jeﬀ Geerling. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible for DevOps: Server and Conﬁguration</span>
     <span 
class="ntx-Italic-tlf-t1-x-x-120">Management for Humans</span>. Midwestern Mac, LLC, 2021.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [3]<span class="bibsp">   </span></span><a 
 id="XansibleForKubernetes"></a>Jeﬀ  Geerling.     <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible  for  Kubernetes:  The  Next  Step</span>
     <span 
class="ntx-Italic-tlf-t1-x-x-120">in  Automating  Infrastructure,  Apps,  and  Kubernetes  Clusters</span>.
     Midwestern Mac, LLC, 2022.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [4]<span class="bibsp">   </span></span><a 
 id="XdynamicInventoryGeerling"></a>Jeﬀ Geerling. Dynamic inventory with ansible and aws. 2022.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [5]<span class="bibsp">   </span></span><a 
 id="XgeerlingYouTube"></a>Jeﬀ Geerling. Learn ansible with practical examples, 2023.
                                                                
                                                                
     </p>
     <p class="bibitem" ><span class="biblabel">
  [6]<span class="bibsp">   </span></span><a 
 id="XansibleModulesRedHat"></a>Red Hat. Top ansible modules and how to use them. 2023.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [7]<span class="bibsp">   </span></span><a 
 id="XansibleVaultRedHat"></a>Red Hat. Using ansible vault to protect sensitive data. 2023.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [8]<span class="bibsp">   </span></span><a 
 id="XansibleUpAndRunning"></a>Lorin Hochstein. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible: Up and Running</span>. O’Reilly Media,
     2017.
     </p>
     <p class="bibitem" ><span class="biblabel">
  [9]<span class="bibsp">   </span></span><a 
 id="XansibleLint"></a>Open Source Community. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible-Lint</span>.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [10]<span class="bibsp">   </span></span><a 
 id="Xmolecule"></a>Open Source Community.  <span 
class="ntx-Italic-tlf-t1-x-x-120">Molecule: Testing Framework for</span>
     <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible</span>.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [11]<span class="bibsp">   </span></span><a 
 id="XansibleBestPractices"></a>Red Hat. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible Best Practices</span>.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [12]<span class="bibsp">   </span></span><a 
 id="XansibleGalaxy"></a>Red Hat. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible Galaxy</span>.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [13]<span class="bibsp">   </span></span><a 
 id="XansibleGitHub"></a>Red Hat. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible GitHub Repository</span>.
                                                                
                                                                
     </p>
     <p class="bibitem" ><span class="biblabel">
 [14]<span class="bibsp">   </span></span><a 
 id="XansibleAWX"></a>Red Hat. <span 
class="ntx-Italic-tlf-t1-x-x-120">AWX (Open Source Ansible Tower)</span>.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [15]<span class="bibsp">   </span></span><a 
 id="XansibleDoc"></a>Red Hat. <span 
class="ntx-Italic-tlf-t1-x-x-120">Ansible Documentation</span>, 2024.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [16]<span class="bibsp">   </span></span><a 
 id="XcommonIssuesTechTarget"></a>TechTarget. Common ansible issues and how to troubleshoot
     them. 2023.
     </p>
     <p class="bibitem" ><span class="biblabel">
 [17]<span class="bibsp">   </span></span><a 
 id="XansibleEssentials"></a>Red Hat   Training.       Ansible   essentials:   Simplicity   in
     automation, 2023.
</p>
     </div>
                                                                
                                                                
                                                                
                                                                
<h2 class="likechapterHead"><a 
 id="x1-1780002"></a>About the Author</h2>
<a 
 id="Q1-1-273"></a>
<!--l. 11--><p class="noindent" >John Stilia is a seasoned DevOps engineer and automation enthusiast, with
a robust ability to streamline infrastructure management, security, and
deployment. With expertise in Ansible, Terraform, Python, Bash,
AWS, Kubernetes, and more, he designs eﬃcient, scalable, and
reliable pipelines that ensure operations run seamlessly. Passionate
about motorbikes, technology, and embedded devices, John has
a proven track record in leading teams and fostering a culture of
collaboration. His inclusive perspective, shaped by his experiences
with ADHD and neurodiversity, brings unique value to any team
dynamic.
</p><!--l. 22--><p class="noindent" >Connect with the author: </p>
      <ul class="itemize1">
      <li class="itemize">
      <!--l. 25--><p class="noindent" >Blog:
      <a 
href="indraft.blog" class="url" ><span 
class="pcrr8t-x-x-120">indraft.blog</span></a>
      </p></li>
      <li class="itemize">
                                                                
                                                                
      <!--l. 26--><p class="noindent" >GitHub:
      <a 
href="github.com/stiliajohny" class="url" ><span 
class="pcrr8t-x-x-120">github.com/stiliajohny</span></a>
      </p></li>
      <li class="itemize">
      <!--l. 27--><p class="noindent" >LinkedIn:
      <a 
href="linkedin.com/in/johnstilia" class="url" ><span 
class="pcrr8t-x-x-120">linkedin.com/in/johnstilia</span></a>
      </p></li>
      <li class="itemize">
      <!--l. 28--><p class="noindent" >Twitter:
      <a 
href="@midnight\_devsec" class="url" ><span 
class="pcrr8t-x-x-120">@midnight' _devsec</span></a></p></li></ul>
                                                                
                                                                
                                                                
                                                                
 
</body></html> 

                                                                


